{"version":3,"file":"testing__protractor.js","sources":["../../../../../../../src/cdk/testing/protractor/protractor-element.ts","../../../../../../../src/cdk/testing/protractor/protractor-harness-environment.ts","../../../../../../../src/cdk/testing/protractor/public-api.ts","../../../../../../../src/cdk/testing/protractor/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ElementDimensions, ModifierKeys, TestElement, TestKey} from '@angular/cdk/testing';\nimport {browser, ElementFinder, Key} from 'protractor';\n\n/** Maps the `TestKey` constants to Protractor's `Key` constants. */\nconst keyMap = {\n  [TestKey.BACKSPACE]: Key.BACK_SPACE,\n  [TestKey.TAB]: Key.TAB,\n  [TestKey.ENTER]: Key.ENTER,\n  [TestKey.SHIFT]: Key.SHIFT,\n  [TestKey.CONTROL]: Key.CONTROL,\n  [TestKey.ALT]: Key.ALT,\n  [TestKey.ESCAPE]: Key.ESCAPE,\n  [TestKey.PAGE_UP]: Key.PAGE_UP,\n  [TestKey.PAGE_DOWN]: Key.PAGE_DOWN,\n  [TestKey.END]: Key.END,\n  [TestKey.HOME]: Key.HOME,\n  [TestKey.LEFT_ARROW]: Key.ARROW_LEFT,\n  [TestKey.UP_ARROW]: Key.ARROW_UP,\n  [TestKey.RIGHT_ARROW]: Key.ARROW_RIGHT,\n  [TestKey.DOWN_ARROW]: Key.ARROW_DOWN,\n  [TestKey.INSERT]: Key.INSERT,\n  [TestKey.DELETE]: Key.DELETE,\n  [TestKey.F1]: Key.F1,\n  [TestKey.F2]: Key.F2,\n  [TestKey.F3]: Key.F3,\n  [TestKey.F4]: Key.F4,\n  [TestKey.F5]: Key.F5,\n  [TestKey.F6]: Key.F6,\n  [TestKey.F7]: Key.F7,\n  [TestKey.F8]: Key.F8,\n  [TestKey.F9]: Key.F9,\n  [TestKey.F10]: Key.F10,\n  [TestKey.F11]: Key.F11,\n  [TestKey.F12]: Key.F12,\n  [TestKey.META]: Key.META\n};\n\n/** Converts a `ModifierKeys` object to a list of Protractor `Key`s. */\nfunction toProtractorModifierKeys(modifiers: ModifierKeys): string[] {\n  const result: string[] = [];\n  if (modifiers.control) {\n    result.push(Key.CONTROL);\n  }\n  if (modifiers.alt) {\n    result.push(Key.ALT);\n  }\n  if (modifiers.shift) {\n    result.push(Key.SHIFT);\n  }\n  if (modifiers.meta) {\n    result.push(Key.META);\n  }\n  return result;\n}\n\n/** A `TestElement` implementation for Protractor. */\nexport class ProtractorElement implements TestElement {\n  constructor(readonly element: ElementFinder) {}\n\n  async blur(): Promise<void> {\n    return browser.executeScript('arguments[0].blur()', this.element);\n  }\n\n  async clear(): Promise<void> {\n    return this.element.clear();\n  }\n\n  async click(...args: number[]): Promise<void> {\n    // Omitting the offset argument to mouseMove results in clicking the center.\n    // This is the default behavior we want, so we use an empty array of offsetArgs if no args are\n    // passed to this method.\n    const offsetArgs = args.length ? [{x: args[0], y: args[1]}] : [];\n\n    await browser.actions()\n      .mouseMove(await this.element.getWebElement(), ...offsetArgs)\n      .click()\n      .perform();\n  }\n\n  async focus(): Promise<void> {\n    return browser.executeScript('arguments[0].focus()', this.element);\n  }\n\n  async getCssValue(property: string): Promise<string> {\n    return this.element.getCssValue(property);\n  }\n\n  async hover(): Promise<void> {\n    return browser.actions()\n        .mouseMove(await this.element.getWebElement())\n        .perform();\n  }\n\n  async sendKeys(...keys: (string | TestKey)[]): Promise<void>;\n  async sendKeys(modifiers: ModifierKeys, ...keys: (string | TestKey)[]): Promise<void>;\n  async sendKeys(...modifiersAndKeys: any[]): Promise<void> {\n    const first = modifiersAndKeys[0];\n    let modifiers: ModifierKeys;\n    let rest: (string | TestKey)[];\n    if (typeof first !== 'string' && typeof first !== 'number') {\n      modifiers = first;\n      rest = modifiersAndKeys.slice(1);\n    } else {\n      modifiers = {};\n      rest = modifiersAndKeys;\n    }\n\n    const modifierKeys = toProtractorModifierKeys(modifiers);\n    const keys = rest.map(k => typeof k === 'string' ? k.split('') : [keyMap[k]])\n        .reduce((arr, k) => arr.concat(k), [])\n        // Key.chord doesn't work well with geckodriver (mozilla/geckodriver#1502),\n        // so avoid it if no modifier keys are required.\n        .map(k => modifierKeys.length > 0 ? Key.chord(...modifierKeys, k) : k);\n\n    return this.element.sendKeys(...keys);\n  }\n\n  async text(): Promise<string> {\n    return this.element.getText();\n  }\n\n  async getAttribute(name: string): Promise<string|null> {\n    return browser.executeScript(\n        `return arguments[0].getAttribute(arguments[1])`, this.element, name);\n  }\n\n  async hasClass(name: string): Promise<boolean> {\n    const classes = (await this.getAttribute('class')) || '';\n    return new Set(classes.split(/\\s+/).filter(c => c)).has(name);\n  }\n\n  async getDimensions(): Promise<ElementDimensions> {\n    const {width, height} = await this.element.getSize();\n    const {x: left, y: top} = await this.element.getLocation();\n    return {width, height, left, top};\n  }\n\n  async getProperty(name: string): Promise<any> {\n    return browser.executeScript(`return arguments[0][arguments[1]]`, this.element, name);\n  }\n\n  async matchesSelector(selector: string): Promise<boolean> {\n      return browser.executeScript(`\n          return (Element.prototype.matches ||\n                  Element.prototype.msMatchesSelector).call(arguments[0], arguments[1])\n          `, this.element, selector);\n  }\n\n  async isFocused(): Promise<boolean> {\n    return this.element.equals(browser.driver.switchTo().activeElement());\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {HarnessEnvironment, HarnessLoader, TestElement} from '@angular/cdk/testing';\nimport {by, element as protractorElement, ElementArrayFinder, ElementFinder} from 'protractor';\nimport {ProtractorElement} from './protractor-element';\n\n/** Options to configure the environment. */\nexport interface ProtractorHarnessEnvironmentOptions {\n  /** The query function used to find DOM elements. */\n  queryFn: (selector: string, root: ElementFinder) => ElementArrayFinder;\n}\n\n/** The default environment options. */\nconst defaultEnvironmentOptions: ProtractorHarnessEnvironmentOptions = {\n  queryFn: (selector: string, root: ElementFinder) => root.all(by.css(selector))\n};\n\n/** A `HarnessEnvironment` implementation for Protractor. */\nexport class ProtractorHarnessEnvironment extends HarnessEnvironment<ElementFinder> {\n  /** The options for this environment. */\n  private _options: ProtractorHarnessEnvironmentOptions;\n\n  protected constructor(\n      rawRootElement: ElementFinder, options?: ProtractorHarnessEnvironmentOptions) {\n    super(rawRootElement);\n    this._options = {...defaultEnvironmentOptions, ...options};\n  }\n\n  /** Creates a `HarnessLoader` rooted at the document root. */\n  static loader(options?: ProtractorHarnessEnvironmentOptions): HarnessLoader {\n    return new ProtractorHarnessEnvironment(protractorElement(by.css('body')), options);\n  }\n\n  async forceStabilize(): Promise<void> {}\n\n  async waitForTasksOutsideAngular(): Promise<void> {\n    // TODO: figure out how we can do this for the protractor environment.\n    // https://github.com/angular/components/issues/17412\n  }\n\n  protected getDocumentRoot(): ElementFinder {\n    return protractorElement(by.css('body'));\n  }\n\n  protected createTestElement(element: ElementFinder): TestElement {\n    return new ProtractorElement(element);\n  }\n\n  protected createEnvironment(element: ElementFinder): HarnessEnvironment<ElementFinder> {\n    return new ProtractorHarnessEnvironment(element, this._options);\n  }\n\n  protected async getAllRawElements(selector: string): Promise<ElementFinder[]> {\n    const elementArrayFinder = this._options.queryFn(selector, this.rawRootElement);\n    const length = await elementArrayFinder.count();\n    const elements: ElementFinder[] = [];\n    for (let i = 0; i < length; i++) {\n      elements.push(elementArrayFinder.get(i));\n    }\n    return elements;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport * from './protractor-element';\nexport * from './protractor-harness-environment';\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport * from './public-api';\n"],"names":["protractorElement"],"mappings":"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"}