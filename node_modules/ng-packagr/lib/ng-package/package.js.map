{"version":3,"file":"package.js","sourceRoot":"","sources":["../../../src/lib/ng-package/package.ts"],"names":[],"mappings":";;AAAA,6BAA6B;AAG7B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA8BG;AACH,MAAa,SAAS;IACpB,YACmB,QAAgB;IACjC;;OAEG;IACa,OAAqB;IACrC;;OAEG;IACa,cAA8B,EAAE;QAR/B,aAAQ,GAAR,QAAQ,CAAQ;QAIjB,YAAO,GAAP,OAAO,CAAc;QAIrB,gBAAW,GAAX,WAAW,CAAqB;IAC/C,CAAC;IAEJ,wGAAwG;IACxG,IAAW,GAAG;QACZ,OAAO,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC;IAED,sCAAsC;IACtC,IAAW,cAAc;QACvB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC7C,CAAC;IAED,4DAA4D;IAC5D,IAAW,IAAI;QACb,OAAO,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC;IAC9C,CAAC;IAED,IAAW,oBAAoB;QAC7B,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,IAAI,CAAC;IAC5D,CAAC;IACD,IAAW,MAAM;QACf,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;IAED,IAAW,8BAA8B;QACvC,2DAA2D;QAC3D,MAAM,QAAQ,GAAG,CAAC,OAAO,CAAC,CAAC;QAC3B,MAAM,KAAK,GAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,gCAAgC,CAAc,IAAI,QAAQ,CAAC;QAE5F,mCAAmC;QACnC,OAAO,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC,CAAC;IAC7F,CAAC;IAEO,uBAAuB,CAAC,GAAW;QACzC,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IAC7D,CAAC;IAEM,UAAU,CAAC,QAAgB;QAChC,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC;IAClG,CAAC;CACF;AAnDD,8BAmDC","sourcesContent":["import * as path from 'path';\nimport { NgEntryPoint } from './entry-point/entry-point';\n\n/**\n * A package being built. Quoting Angular Package Format, a package is:\n *\n * > the smallest set of files that are published to NPM and installed together, for example\n * > `@angular/core`. (..) The package is installed with `npm install @angular/core`.\n *\n * #### Package and Entry Points\n *\n * A package is composed of several (one or more) entry points.\n * A package must contain at least the primary entry point but can have many secondary entry\n * points.\n * The module ID of the primary entry point, e.g. `@angular/core`, matches the package name, e.g.\n * the package name is given to the command `npm install @angular/core`.\n * The source code files within a package are referenced by the entry points.\n *\n * #### Representation in the domain\n *\n * A _Package_ is reflected by `NgPackage`.\n * An _Entry Point_ is reflected by `NgEntryPoint`.\n * One `NgPackage` relates to one (or many) `NgEentryPoint`,\n * one `NgEntryPoint` relates to one `NgPackage`.\n *\n * #### Watch Out\n *\n * The user's configuration `ngPackage` suggests that it reflects a `NgPackage`.\n * However, the values given in the `lib` property reflect an `NgEntryPoint`.\n * In case the package contains only one entry point, `ngPackage.lib` reflects the primary entry\n * point.\n *\n * @link https://docs.google.com/document/d/1CZC2rcpxffTDfRDs6p1cfbmKNLA6x5O-NtkJglDaBVs/edit#\n */\nexport class NgPackage {\n  constructor(\n    private readonly basePath: string,\n    /**\n     * A reference to the primary entry point.\n     */\n    public readonly primary: NgEntryPoint,\n    /**\n     * An array of seconary entry points.\n     */\n    public readonly secondaries: NgEntryPoint[] = [],\n  ) {}\n\n  /** Absolute path of the package's source folder, derived from the user's (primary) package location. */\n  public get src(): string {\n    return this.basePath;\n  }\n\n  /** Delete output path before build */\n  public get deleteDestPath(): boolean {\n    return this.primary.$get('deleteDestPath');\n  }\n\n  /** Absolute path of the package's destination directory. */\n  public get dest(): string {\n    return this.absolutePathFromPrimary('dest');\n  }\n\n  public get keepLifecycleScripts(): boolean {\n    return this.primary.$get('keepLifecycleScripts') === true;\n  }\n  public get assets(): string[] {\n    return this.primary.$get('assets');\n  }\n\n  public get whitelistedNonPeerDependencies(): string[] {\n    // XX: default array values from JSON schema not recognized\n    const defValue = ['tslib'];\n    const value = (this.primary.$get('whitelistedNonPeerDependencies') as string[]) || defValue;\n\n    // Always append 'tslib' and dedupe\n    return value.concat('tslib').filter((value, index, self) => self.indexOf(value) === index);\n  }\n\n  private absolutePathFromPrimary(key: string) {\n    return path.resolve(this.basePath, this.primary.$get(key));\n  }\n\n  public entryPoint(moduleId: string): NgEntryPoint {\n    return [this.primary, ...this.secondaries].find(entryPoint => entryPoint.moduleId === moduleId);\n  }\n}\n"]}