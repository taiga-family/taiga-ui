(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[92907],{92907:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var r=n(37550),i=n(15585),a=n(87742),o=n(92229),s=n(52358),c=n(64016),d=n(81359),l=n(40975),p=n(37481),m=n(59996),u=n(61204),y=n(25358),f=n(55514);const g={ByNewCard:0,BySavedCard:1};var h=n(44046);const b=[{cardId:"1",firstSix:"4242",lastFour:"4242",cardType:"Visa"},{cardId:"2",firstSix:"5555",lastFour:"4444",cardType:"MasterCard"},{cardId:"3",firstSix:"2200",lastFour:"6404",cardType:"Mir"}];let _=(()=>{var e;class t{constructor(){this.isE2E=(0,r.WQX)(p.Hs4)}preparePayment(e){return(0,h.O)(this.getRandomDelay()).pipe((0,f.T)((()=>e)))}getPrimaryCard(){return(0,h.O)(this.getRandomDelay()).pipe((0,f.T)((()=>b)),(0,f.T)((e=>({primary:e[0],cards:e}))))}pay(){return(0,h.O)(this.getRandomDelay()).pipe((0,f.T)((()=>{})))}getRandomDelay(){return this.isE2E?0:3e3*Math.random()}}return(e=t).ɵfac=function(t){return new(t||e)},e.ɵprov=r.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),t})();var C=n(25083);const v=["cardGroupedInput"];function M(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",4)(1,"div",10),r.bIt("click",(function(){const t=r.eBV(e).$implicit,n=r.XpG();return r.Njj(n.payBySelectedCard(t))})),r.j41(2,"div",11)(3,"div",12)(4,"div",13),r.EFF(5,"Card number"),r.k0s(),r.j41(6,"div",14),r.nrm(7,"img",15),r.nI1(8,"tuiIcon"),r.j41(9,"div",16),r.EFF(10),r.k0s()()()()()()}if(2&e){const e=t.$implicit;r.R7$(7),r.Y8G("src",r.bMT(8,3,"MasterCard"===e.cardType?"@tui.maestro":"Visa"===e.cardType?"@tui.visa":"@tui.mir"),r.B4B),r.R7$(3),r.Lme(" ",e.firstSix,"****",e.lastFour," ")}}function k(e,t){1&e&&r.nrm(0,"input",5)}function x(e,t){1&e&&(r.j41(0,"p"),r.EFF(1,"Please wait, we are loading fake cards..."),r.k0s())}function P(e,t){1&e&&(r.j41(0,"div",4)(1,"label",17),r.nrm(2,"input",18),r.EFF(3," Remember card "),r.k0s()())}function B(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",8)(1,"button",19),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.payByNewCard())})),r.EFF(2," New card "),r.k0s()()}}let O=(()=>{var e;class t{constructor(){this.payService=(0,r.WQX)(_),this.destroyRef=(0,r.WQX)(r.abz),this.form=new a.gE({card:new a.MJ(null,[a.k0.required,e=>{const{value:t}=e;return t?.cvc&&t.cvc.length<3?{invalidCvc:!0}:null}]),saveCard:new a.MJ(!0)}),this.iOS=(0,r.WQX)(p.mg4),this.cards=[],this.paymentMode=g.ByNewCard,this.loading$=new u.t(!1),this.payProcessing$=new u.t(!1),this.paymentModeTypes=g,this.context=(0,m.Dm)(),this.amount=this.context.data.amount}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(e){this.form.patchValue({card:{card:this.maskedNumber(e),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(l.WK),this.paymentMode=g.BySavedCard,this.cardGroupedInput?.focusCVC()}payByNewCard(){this.form.patchValue({card:null}),this.form.controls.card.addValidators(l.WK),this.paymentMode=g.ByNewCard,this.cardGroupedInput?.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe((0,i.pQ)(this.destroyRef)).subscribe({next:()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()},error:()=>{this.payProcessing$.next(!1)}}))}cardValidator(e){return(0,l.Cz)(e)&&16===e.length}maskedNumber(e){return`${e.firstSix.slice(0,-2)}***${e.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe((0,y.n)((e=>this.payService.getPrimaryCard().pipe((0,f.T)((t=>[e,t]))))),(0,i.pQ)(this.destroyRef)).subscribe({next:([,e])=>{this.cards=e.cards,e.primary?this.payBySelectedCard(e.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}}return(e=t).ɵfac=function(t){return new(t||e)},e.ɵcmp=r.VBU({type:e,selectors:[["pay-modal"]],viewQuery:function(e,t){if(1&e&&r.GBs(v,5),2&e){let e;r.mGM(e=r.lsd())&&(t.cardGroupedInput=e.first)}},decls:21,vars:21,consts:[["cardGroupedInput",""],[1,"modal-container"],[1,"title"],[3,"formGroup"],[1,"form-block"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"loading","overlay"],["formControlName","card",3,"cardValidator","tuiTextfieldCleaner"],[1,"form-block","is--links"],["appearance","primary","size","l","tuiButton","","type","submit",3,"click","loading"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],["alt","card",1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],["iconStart","@tui.plus","tuiLink","","type","button",3,"click"]],template:function(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",1)(1,"h1",2),r.EFF(2,"Pay by card"),r.k0s(),r.j41(3,"form",3),r.Z7z(4,M,11,5,"div",4,r.fX1),r.j41(6,"div",4),r.DNE(7,k,1,0,"input",5),r.SS7(8),r.nI1(9,"async"),r.DNE(10,x,2,0,"p"),r.j41(11,"tui-loader",6),r.nrm(12,"tui-input-card-group",7,0),r.k0s()(),r.DNE(14,P,4,0,"div",4)(15,B,3,0,"div",8),r.k0s(),r.j41(16,"button",9),r.nI1(17,"async"),r.bIt("click",(function(){return r.eBV(e),r.Njj(t.pay())})),r.EFF(18),r.nI1(19,"tuiFormatNumber"),r.nI1(20,"async"),r.k0s()()}if(2&e){let e;r.R7$(3),r.Y8G("formGroup",t.form),r.R7$(),r.Dyx(t.cards),r.R7$(3),r.vxM(t.iOS?7:-1);const n=null!==(e=r.bMT(9,13,t.loading$))&&void 0!==e&&e;r.R7$(3),r.vxM(n?10:-1),r.R7$(),r.Y8G("loading",n)("overlay",!0),r.R7$(),r.AVh("without-date",t.paymentMode===t.paymentModeTypes.BySavedCard),r.Y8G("cardValidator",t.cardValidator)("tuiTextfieldCleaner",t.paymentMode===t.paymentModeTypes.ByNewCard),r.R7$(2),r.vxM(t.paymentMode===t.paymentModeTypes.ByNewCard?14:-1),r.R7$(),r.vxM(t.paymentMode===t.paymentModeTypes.BySavedCard?15:-1),r.R7$(),r.Y8G("loading",!!r.bMT(17,15,t.payProcessing$)),r.R7$(2),r.SpI(" Pay ",r.bMT(20,19,r.bMT(19,17,t.amount))," ₽ ")}},dependencies:[d.Jj,a.X1,a.qT,a.Zm,a.BC,a.cb,a.j4,a.JD,p.s8y,o.paf,s.FPM,s.GYS,o.VX$,o.KYT,l.Qf,o.Jc3,o.apU,C.z,o.TB_],styles:['[_nghost-%COMP%]     tui-input-card-group{inline-size:100%!important}[_nghost-%COMP%]     tui-input-card-group.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-group.without-date tui-icon[icon="@tui.x"]{display:none}[_nghost-%COMP%]     tui-input-card-group .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{inline-size:30rem}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{inline-size:100%}}.title[_ngcontent-%COMP%]{margin:0 0 1rem;font-weight:500;font-size:1.125rem;line-height:1.625rem;letter-spacing:.01125rem}.form-block[_ngcontent-%COMP%]{position:relative;margin-block-end:1rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{display:flex;block-size:3.5rem;background:#fafbfb;border-radius:1rem;border:2px solid #eaeaea;padding:0 1rem;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.015rem;font-size:.75rem;line-height:1.125rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{inline-size:2.25rem;block-size:1.375rem;background-position:center;background-repeat:no-repeat;margin-inline-end:.5rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:1.375rem;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:.875rem;line-height:1.25rem}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-inline-start:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;inline-size:100%;caret-color:transparent;cursor:none;color:transparent}'],changeDetection:0}),t})(),w=(()=>{var e;class t{constructor(){this.destroyRef=(0,r.WQX)(r.abz),this.payModal=(0,c.$V3)(O,{size:"auto",closable:!0}),this.amountControl=new a.MJ(100,{nonNullable:!0})}payByCard(){this.payModal({amount:this.amountControl.value}).pipe((0,i.pQ)(this.destroyRef)).subscribe()}}return(e=t).ɵfac=function(t){return new(t||e)},e.ɵcmp=r.VBU({type:e,selectors:[["ng-component"]],decls:13,vars:11,consts:[[1,"container"],["maxlength","5","placeholder","0 ... 999 ₽","postfix"," ₽","tuiInputNumber","",3,"formControl","min"],["tuiHintDirection","top","tuiTooltip","The amount must be less than 1000 ₽"],["tuiButton","","type","button",1,"pay-button",3,"click"],[1,"icon-group"],["alt","visa",3,"src"],["alt","maestro",3,"src"],["alt","mir",3,"src"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"tui-textfield"),r.nrm(2,"input",1)(3,"tui-icon",2),r.k0s(),r.j41(4,"button",3),r.bIt("click",(function(){return t.payByCard()})),r.j41(5,"div",4),r.nrm(6,"img",5),r.nI1(7,"tuiIcon"),r.nrm(8,"img",6),r.nI1(9,"tuiIcon"),r.nrm(10,"img",7),r.nI1(11,"tuiIcon"),r.k0s(),r.EFF(12," Pay "),r.k0s()()),2&e&&(r.R7$(2),r.Y8G("formControl",t.amountControl)("min",0),r.R7$(4),r.Y8G("src",r.bMT(7,5,"@tui.visa"),r.B4B),r.R7$(2),r.Y8G("src",r.bMT(9,7,"@tui.maestro"),r.B4B),r.R7$(2),r.Y8G("src",r.bMT(11,9,"@tui.mir"),r.B4B))},dependencies:[a.X1,a.me,a.BC,a.tU,a.l_,o.paf,o.qo5,o.KYT,s.xhp,o.Bwv,s.w1A],styles:[".container[_ngcontent-%COMP%]{inline-size:100%;max-inline-size:30rem;margin:0 auto;padding-block-start:1.25rem}.pay-button[_ngcontent-%COMP%]{margin-block-start:1rem;inline-size:100%}.icon-group[_ngcontent-%COMP%]{display:flex;gap:.125rem;background:#f6f6f6;padding:.125rem .3125rem;margin-inline-end:.5rem;border-radius:.3125rem}img[_ngcontent-%COMP%]{inline-size:1.5rem;block-size:1.5rem}"],changeDetection:0}),t})()}}]);