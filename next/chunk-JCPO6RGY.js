import{c as W}from"./chunk-LGDPDKJJ.js";import{Pb as A,Va as B,Wb as O,Xb as N,_a as H,sd as U,ud as K,za as y}from"./chunk-ET2ZSIIN.js";import{a as f,b as P,i as V}from"./chunk-42JZD6NG.js";function Z(s){let{anchorOffset:t=0,focusOffset:i=0}=s.ownerDocument.getSelection()||{},e=Math.min(t,i),n=Math.max(t,i);return[e,n]}function X(s,[t,i]){var r,c;let e=s.ownerDocument,n=e.createRange();n.setStart(s.firstChild||s,Math.min(t,((r=s.textContent)==null?void 0:r.length)??0)),n.setEnd(s.lastChild||s,Math.min(i,((c=s.textContent)==null?void 0:c.length)??0));let o=e.getSelection();o&&(o.removeAllRanges(),o.addRange(n))}var D=class{constructor(t){this.element=t,this.maxLength=1/0}get value(){return this.element.innerText.replace(/\n\n$/,`
`)}set value(t){this.element.innerHTML=t.replace(/\n$/,`

`)}get selectionStart(){return Z(this.element)[0]}get selectionEnd(){return Z(this.element)[1]}setSelectionRange(t,i){X(this.element,[t??0,i??0])}select(){this.setSelectionRange(0,this.value.length)}};function z(s){let t=new D(s);return new Proxy(s,{get(i,e){if(e in t)return t[e];let n=i[e];return typeof n=="function"?n.bind(i):n},set(i,e,n,o){return Reflect.set(e in t?t:i,e,n,o)}})}var q=s=>s.isContentEditable?z(s):s.querySelector("input,textarea")||s,L={mask:/^.*$/,preprocessors:[],postprocessors:[],plugins:[],overwriteMode:"shift"},R=class{constructor(){this.now=null,this.past=[],this.future=[]}undo(){let t=this.past.pop();t&&this.now&&(this.future.push(this.now),this.updateElement(t,"historyUndo"))}redo(){let t=this.future.pop();t&&this.now&&(this.past.push(this.now),this.updateElement(t,"historyRedo"))}updateHistory(t){if(!this.now){this.now=t;return}let i=this.now.value!==t.value,e=this.now.selection.some((n,o)=>n!==t.selection[o]);!i&&!e||(i&&(this.past.push(this.now),this.future=[]),this.now=t)}updateElement(t,i){this.now=t,this.updateElementState(t,{inputType:i,data:null})}};function J(s,...t){return t.every(({value:i})=>i===s.value)}function b(s,...t){return t.every(({value:i,selection:e})=>i===s.value&&e[0]===s.selection[0]&&e[1]===s.selection[1])}function _({value:s,selection:t},i,e){let[n,o]=t,r=typeof e=="function"?e({value:s,selection:t}):e;return{value:s,selection:r==="replace"?[n,Math.max(n+i.length,o)]:[n,o]}}function C(s){return typeof s=="string"}function $(s,t,i,e){let n="";for(let o=t.length;o<s.length;o++){let r=s[o]||"",c=(e==null?void 0:e.value[o])===r;if(!C(r)||r===i&&!c)return n;n+=r}return n}function Y(s,t){return Array.isArray(t)?s.length===t.length&&Array.from(s).every((i,e)=>{let n=t[e]||"";return C(n)?i===n:i.match(n)}):t.test(s)}function Q(s,t,i){let e=null,n=null,o=Array.from(s.value).reduce((c,a,l)=>{let u=$(t,c,a,i),h=c+u,d=t[h.length]||"";return e===null&&l>=s.selection[0]&&(e=h.length),n===null&&l>=s.selection[1]&&(n=h.length),C(d)?h+d:a.match(d)?h+a:u.startsWith(a)?h:c},""),r=$(t,o,"",i);return{value:Y(o+r,t)?o+r:o,selection:[e??o.length,n??o.length]}}function tt({value:s,selection:t},i){let[e,n]=t,o=e,r=n,c=Array.from(s).reduce((a,l,u)=>{let h=a+l;return e===u&&(o=a.length),n===u&&(r=a.length),h.match(i)?h:a},"");return{value:c,selection:[Math.min(o,c.length),Math.min(r,c.length)]}}function k(s,t,i=null){if(Y(s.value,t))return s;let{value:e,selection:n}=Array.isArray(t)?Q(s,t,i):tt(s,t);return{selection:n,value:Array.isArray(t)?e.slice(0,t.length):e}}function G(s,t){if(!Array.isArray(t))return s;let[i,e]=s.selection,n=[],o=Array.from(s.value).reduce((r,c,a)=>{let l=t[a]||"";return a===i&&n.push(r.length),a===e&&n.push(r.length),C(l)&&l===c?r:r+c},"");return n.length<2&&n.push(...new Array(2-n.length).fill(o.length)),{value:o,selection:[n[0],n[1]]}}var E=class{constructor(t,i){this.maskOptions=i,this.unmaskInitialState={value:"",selection:[0,0]},this.value="",this.selection=[0,0];let e=this.getMaskExpression(t),{value:n,selection:o}=k(t,e);this.unmaskInitialState=G({value:n,selection:o},e),this.value=n,this.selection=o}addCharacters(t){let{value:i,selection:e,maskOptions:n}=this,o={value:i,selection:e},{selection:[r,c]}=_(o,t,n.overwriteMode),a=this.getMaskExpression({value:i.slice(0,r)+t+i.slice(c),selection:[r+t.length,r+t.length]}),[l,u]=_(this.unmaskInitialState,t,n.overwriteMode).selection,h=this.unmaskInitialState.value.slice(0,l)+t,d=h.length,x=k({value:h+this.unmaskInitialState.value.slice(u),selection:[d,d]},a,o),F=i.slice(0,r),I=k({value:h,selection:[d,d]},a,o);if(I.value===F||I.value.length<F.length&&G(I,a).value===this.unmaskInitialState.value.slice(0,l)||b(this,x))throw new Error("Invalid mask value");this.value=x.value,this.selection=x.selection}deleteCharacters(){let[t,i]=this.selection;if(t===i||!i)return;let{value:e}=this,n=this.getMaskExpression({value:e.slice(0,t)+e.slice(i),selection:[t,t]}),o={value:e},[r,c]=this.unmaskInitialState.selection,a=this.unmaskInitialState.value.slice(0,r)+this.unmaskInitialState.value.slice(c),l=k({value:a,selection:[r,r]},n,o);this.value=l.value,this.selection=l.selection}getMaskExpression(t){let{mask:i}=this.maskOptions;return typeof i=="function"?i(t):i}},v=class{constructor(t){this.element=t,this.listeners=[]}listen(t,i,e){let n=i;this.element.addEventListener(t,n,e),this.listeners.push(()=>this.element.removeEventListener(t,n,e))}destroy(){this.listeners.forEach(t=>t())}},p={CTRL:1,ALT:2,SHIFT:4,META:8},m={Y:89,Z:90};function g(s,t,i){return s.ctrlKey===!!(t&p.CTRL)&&s.altKey===!!(t&p.ALT)&&s.shiftKey===!!(t&p.SHIFT)&&s.metaKey===!!(t&p.META)&&s.keyCode===i}function et(s){return g(s,p.CTRL,m.Y)||g(s,p.CTRL|p.SHIFT,m.Z)||g(s,p.META|p.SHIFT,m.Z)}function nt(s){return g(s,p.CTRL,m.Z)||g(s,p.META,m.Z)}function st(s,t){var e;let i=s.value;if(typeof t=="string")s.value=t;else{let[n,o]=t.selection;s.value=t.value,s.matches(":focus")&&((e=s.setSelectionRange)==null||e.call(s,n,o))}s.value!==i&&s.dispatchEvent(new Event("input",{bubbles:!0}))}function it({value:s,selection:t},i){let[e,n]=t;if(e!==n)return[e,n];let o=i?s.slice(e).indexOf(`
`)+1||s.length:s.slice(0,n).lastIndexOf(`
`)+1;return[i?e:o,i?o:n]}function ot({value:s,selection:t},i){let[e,n]=t;return e!==n?[e,n]:(i?[e,n+1]:[e-1,n]).map(r=>Math.min(Math.max(r,0),s.length))}var rt=/\s+$/g,at=/^\s+/g,j=/\s/;function ct({value:s,selection:t},i){let[e,n]=t;if(e!==n)return[e,n];if(i){let a=s.slice(e),[l]=a.match(at)||[""],u=a.trimStart().search(j);return[e,u!==-1?e+l.length+u:s.length]}let o=s.slice(0,n),[r]=o.match(rt)||[""],c=o.trimEnd().split("").reverse().findIndex(a=>j.exec(a));return[c!==-1?n-r.length-c:0,n]}function T(s=[]){return(t,...i)=>s.reduce((e,n)=>f(f({},e),n(e,...i)),t)}function S(s,t){let i=f(f({},L),t),e=T(i.preprocessors),n=T(i.postprocessors),o=typeof s=="string"?{value:s,selection:[0,0]}:s,{elementState:r}=e({elementState:o,data:""},"validation"),c=new E(r,i),{value:a,selection:l}=n(c,o);return typeof s=="string"?a:{value:a,selection:l}}function lt(){return s=>{let t=new v(s),i=!1,e,n=s.value;return t.listen("keydown",({key:o})=>{i=o==="Unidentified"}),t.listen("beforeinput",o=>{e=o,n=s.value}),t.listen("input",o=>{i&&e.defaultPrevented&&e.inputType==="deleteContentBackward"&&o.inputType==="deleteContentBackward"&&(s.value=n)},{capture:!0}),()=>t.destroy()}}var M=" ";function ut(){let s="",t=0,i=null,e=!1;return n=>{let o=new v(n);return o.listen("beforeinput",r=>{var h,d;let{value:c,selectionStart:a,selectionEnd:l}=n,u=(i==null?void 0:i.inputType)==="insertText"&&(i==null?void 0:i.data)===M&&!c.slice(0,Number(l)).endsWith(M);r.inputType==="insertText"&&r.data===`.${M}`&&((i==null?void 0:i.inputType)==="deleteContentBackward"&&e?(n.value=s,(h=n.setSelectionRange)==null||h.call(n,t,t)):u&&((d=n.setSelectionRange)==null||d.call(n,a,a))),e=u,i=r,s=c,t=Number((u?t:l)===c.length?l:a)}),()=>o.destroy()}}function pt(s){return(t,i)=>{let e=t.selectionStart??0,n=t.selectionEnd??0;st(t,{value:S(t.value,s||i),selection:[e,n]})}}var ht=[ut(),lt()],w=class extends R{constructor(t,i){super(),this.element=t,this.maskitoOptions=i,this.isTextArea=this.element.nodeName==="TEXTAREA",this.eventListener=new v(this.element),this.options=f(f({},L),this.maskitoOptions),this.upcomingElementState=null,this.preprocessor=T(this.options.preprocessors),this.postprocessor=T(this.options.postprocessors),this.teardowns=this.options.plugins.concat(ht).map(e=>e(this.element,this.options)),this.updateHistory(this.elementState),this.eventListener.listen("keydown",e=>{if(et(e))return e.preventDefault(),this.redo();if(nt(e))return e.preventDefault(),this.undo()}),this.eventListener.listen("beforeinput",e=>{var o;let n=e.inputType.includes("Forward");switch(this.updateHistory(this.elementState),e.inputType){case"deleteByCut":case"deleteContentBackward":case"deleteContentForward":return this.handleDelete({event:e,isForward:n,selection:ot(this.elementState,n)});case"deleteHardLineBackward":case"deleteHardLineForward":case"deleteSoftLineBackward":case"deleteSoftLineForward":return this.handleDelete({event:e,isForward:n,selection:it(this.elementState,n),force:!0});case"deleteWordBackward":case"deleteWordForward":return this.handleDelete({event:e,isForward:n,selection:ct(this.elementState,n)});case"historyRedo":return e.preventDefault(),this.redo();case"historyUndo":return e.preventDefault(),this.undo();case"insertCompositionText":return;case"insertLineBreak":case"insertParagraph":return this.handleEnter(e);case"insertReplacementText":return;case"insertFromDrop":case"insertFromPaste":case"insertText":default:return this.handleInsert(e,e.data??((o=e.dataTransfer)==null?void 0:o.getData("text/plain"))??"")}}),this.eventListener.listen("input",()=>{this.upcomingElementState&&!b(this.upcomingElementState,this.elementState)&&this.updateElementState(this.upcomingElementState),this.upcomingElementState=null},{capture:!0}),this.eventListener.listen("input",({inputType:e})=>{e!=="insertCompositionText"&&(this.ensureValueFitsMask(),this.updateHistory(this.elementState))}),this.eventListener.listen("compositionend",()=>{this.ensureValueFitsMask(),this.updateHistory(this.elementState)})}destroy(){this.eventListener.destroy(),this.teardowns.forEach(t=>t==null?void 0:t())}updateElementState({value:t,selection:i},e){let n=this.elementState.value;this.updateValue(t),this.updateSelectionRange(i),e&&n!==t&&this.dispatchInputEvent(e)}get elementState(){let{value:t,selectionStart:i,selectionEnd:e}=this.element;return{value:t,selection:[i??0,e??0]}}get maxLength(){let{maxLength:t}=this.element;return t===-1?1/0:t}updateSelectionRange([t,i]){var n;let{element:e}=this;e.matches(":focus")&&(e.selectionStart!==t||e.selectionEnd!==i)&&((n=e.setSelectionRange)==null||n.call(e,t,i))}updateValue(t){(this.element.value!==t||this.element.isContentEditable)&&(this.element.value=t)}ensureValueFitsMask(){this.updateElementState(S(this.elementState,this.options),{inputType:"insertText",data:null})}dispatchInputEvent(t={inputType:"insertText",data:null}){globalThis.InputEvent&&this.element.dispatchEvent(new InputEvent("input",P(f({},t),{bubbles:!0,cancelable:!1})))}handleDelete({event:t,selection:i,isForward:e}){let n={value:this.elementState.value,selection:i},{elementState:o}=this.preprocessor({elementState:n,data:""},e?"deleteForward":"deleteBackward"),r=new E(o,this.options);r.deleteCharacters();let c=this.postprocessor(r,n);if(J(n,o,r,c)){let[a,l]=o.selection;return t.preventDefault(),this.updateSelectionRange(e?[l,l]:[a,a])}this.upcomingElementState=c}handleInsert(t,i){let{options:e,maxLength:n,elementState:o}=this,[r,c]=o.selection,{elementState:a,data:l=i}=this.preprocessor({data:i,elementState:o},"insert"),u=new E(a,e);try{u.addCharacters(l)}catch{return t.preventDefault()}this.upcomingElementState=this.clampState(this.postprocessor(u,o)),o.value.length>=n&&r===c&&(e.overwriteMode==="replace"&&!b(this.upcomingElementState,o)?this.dispatchInputEvent({inputType:"insertText",data:i}):this.upcomingElementState=null)}handleEnter(t){(this.isTextArea||this.element.isContentEditable)&&this.handleInsert(t,`
`)}clampState({value:t,selection:i}){let[e,n]=i,o=this.maxLength;return{value:t.slice(0,o),selection:[Math.min(e,o),Math.min(n,o)]}}};var wt=(()=>{let t=class t{constructor(){this.elementRef=y(H).nativeElement,this.ngZone=y(B),this.maskedElement=null,this.initEffect=K(()=>V(this,null,function*(){let n=this.options(),o=this.elementPredicate(),{maskedElement:r,elementRef:c,ngZone:a}=this;if(r==null||r.destroy(),!n)return;let l=yield o(c);this.elementPredicate()!==o||this.options()!==n||a.runOutsideAngular(()=>{this.maskedElement=new w(l,n)})})),this.options=A(null,{alias:"maskito"}),this.elementPredicate=A(q,{alias:"maskitoElement"});let e=y(W,{self:!0,optional:!0});if(e){let n=e.writeValue.bind(e);e.writeValue=o=>{let r=U(()=>this.options());n(r?S(String(o??""),r):o)}}}ngOnDestroy(){var e;(e=this.maskedElement)==null||e.destroy()}};t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=O({type:t,selectors:[["","maskito",""]],inputs:{options:[1,"maskito","options"],elementPredicate:[1,"maskitoElement","elementPredicate"]},outputs:{options:"maskitoChange",elementPredicate:"maskitoElementChange"}});let s=t;return s})(),Lt=(()=>{let t=class t{transform(e,n){return S(String(e??""),n??L)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275pipe=N({name:"maskito",type:t,pure:!0});let s=t;return s})();export{L as a,st as b,S as c,pt as d,wt as e,Lt as f};
