import{J as k,Pb as G,Va as P,Za as B,a as L,bb as W,ea as z,f as M,h as C,ja as u,jb as Z,mb as V,tb as q,ub as j}from"./chunk-JGAIOO3T.js";import{a as w}from"./chunk-ID7P2QVS.js";import{$a as H,Cb as N,Cc as D,E as m,Ib as U,J as F,S as O,Ta as x,Wa as S,Xb as d,Yc as _,_a as R,ha as A,oa as I,w as b,wa as g,za as l}from"./chunk-PVL5PQAX.js";var s=class{constructor(r,e){this.el=r;this.options=e}get element(){return(this.el.nativeElement.tagName.includes("-")?this.el.nativeElement.querySelector(this.options.query):this.el.nativeElement)||this.el.nativeElement}get isTextFieldElement(){return this.element.matches(this.options.query)}};var K=1e3,Q=".ng-animating",f=class extends s{constructor(e,t,i,o){super(e,o);this.animationFrame$=t;this.zone=i}setFocus(){this.isTextFieldElement?F(m(this.options.delay||K),this.animationFrame$.pipe(I(100,P(this.zone)),b(()=>this.element.closest(Q)),A(Boolean),O(1))).subscribe(()=>this.element.focus({preventScroll:this.options.preventScroll})):this.element.focus({preventScroll:!0})}};var Y=["type","inputMode","autocomplete","accept","min","max","step","pattern","size","maxlength"],h=class extends s{constructor(e,t,i,o,n){super(e,n);this.renderer=t;this.zone=i;this.win=o}setFocus(){this.isTextFieldElement?this.zone.runOutsideAngular(()=>this.iosWebkitAutofocus()):this.element.focus({preventScroll:!0})}iosWebkitAutofocus(){var E;let e=this.makeFakeInput(),t=this.getDurationTimeBeforeFocus(),i=0,o=0,n=()=>e.focus({preventScroll:!0}),T=()=>{clearTimeout(i),i=this.win.setTimeout(()=>{clearTimeout(o),e.removeEventListener("blur",n),e.removeEventListener("focus",T),o=this.win.setTimeout(()=>{this.element.focus({preventScroll:this.options.preventScroll}),e.remove()},t)})};e.addEventListener("blur",n,{once:!0}),e.addEventListener("focus",T),this.insideDialog()?this.win.document.body.appendChild(e):(E=this.element.parentElement)==null||E.appendChild(e),e.focus({preventScroll:!0})}makeFakeInput(){let e=this.renderer.createElement("input"),t=this.element.getBoundingClientRect();return this.patchFakeInputFromFocusableElement(e),e.style.height=u(t.height),e.style.width=u(t.width/2),e.style.position="fixed",e.style.zIndex="-99999999",e.style.caretColor="transparent",e.style.border="none",e.style.outline="none",e.style.color="transparent",e.style.background="transparent",e.style.cursor="none",e.style.fontSize=u(16),e.style.top=u(t.top),e.style.left=u(t.left),e}getDurationTimeBeforeFocus(){return parseFloat(this.win.getComputedStyle(this.element).getPropertyValue("--tui-duration"))||0}insideDialog(){return!!this.element.closest("tui-dialog")}patchFakeInputFromFocusableElement(e){Y.forEach(t=>{let i=this.element.getAttribute(t);z(i)&&e.setAttribute(t,i)})}};var[v,he]=k({delay:NaN,query:"input, textarea, select, [contenteditable]",preventScroll:!1}),y=new g(""),X=[{provide:y,deps:[H,C,U,S,M,G,v],useFactory:(c,r,e,t,i,o,n)=>o?new h(c,e,t,i,n):new f(c,r,t,n)}];var a=class a{constructor(){this.handler=l(y);this.options=l(v);this.destroyRef=l(x);this.autoFocus=R(void 0,{alias:"tuiAutoFocus",transform:V})}ngAfterViewInit(){this.autoFocus()&&this.focus()}focus(){Number.isNaN(this.options.delay)?Promise.resolve().then(()=>this.handler.setFocus()):m(this.options.delay).pipe(L(this.destroyRef)).subscribe(()=>this.handler.setFocus())}};a.\u0275fac=function(e){return new(e||a)},a.\u0275dir=d({type:a,selectors:[["","tuiAutoFocus",""]],inputs:{autoFocus:[1,"tuiAutoFocus","autoFocus"]},features:[_(X)]});var $=a;var p=class p{constructor(){this.doc=l(w);this.el=Z();this.activeElement=null;this.initialized=!1;Promise.resolve().then(()=>{this.initialized=!0,this.activeElement=j(this.doc),this.el.focus()})}ngOnDestroy(){this.initialized=!1,W(this.activeElement)&&this.activeElement.focus()}onFocusIn(r){var t;let{firstElementChild:e}=this.el;!B(this.el,r)&&e&&((t=q({initial:e,root:this.el}))==null||t.focus())}};p.\u0275fac=function(e){return new(e||p)},p.\u0275dir=d({type:p,selectors:[["","tuiFocusTrap",""]],hostAttrs:["tabIndex","0"],hostBindings:function(e,t){e&1&&D("focusin.zoneless",function(o){return t.initialized&&t.onFocusIn(o.target)},!1,N)("pointerdown",function(o){return o.currentTarget==null?null:o.currentTarget.removeAttribute("tabindex")})}});var J=p;export{he as a,$ as b,J as c};
