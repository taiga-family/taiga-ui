@if (heading()) {
    <header tuiHeader="h6">
        <hgroup tuiTitle>
            <h2>
                <a
                    appearance=""
                    routerLink="."
                    tuiLink
                    class="t-link"
                    [attr.title]="copy()"
                    [fragment]="id()"
                    [iconEnd]="icons.link"
                    [relativeTo]="route.firstChild ?? route"
                    (click)="copyExampleLink($event.currentTarget)"
                >
                    {{ heading() }}
                </a>
            </h2>
            @if (description()) {
                <p>
                    <ng-container *polymorpheusOutlet="description() as text">
                        {{ text }}
                    </ng-container>
                </p>
            }
        </hgroup>
    </header>
}
<div
    class="t-example"
    [(tuiFullscreen)]="fullscreen"
>
    @if (processor() | tuiDocExampleGetTabs: defaultTab; as all) {
        @let tabs = example() ? all : all.slice(1);
        <div class="t-header">
            <tui-segmented
                class="t-tabs"
                [(activeItemIndex)]="activeItemIndex"
            >
                @for (tab of tabs; track tab) {
                    <button type="button">
                        <ng-container *polymorpheusOutlet="getTabTitle(tab) as text">
                            {{ text }}
                        </ng-container>
                    </button>
                }
            </tui-segmented>
            @if (processor() | tuiMapper: visible) {
                <tui-loader
                    size="xs"
                    class="t-code-editor"
                    [loading]="loading()"
                    [overlay]="true"
                    (click)="edit(processor())"
                >
                    @if (codeEditor?.content; as content) {
                        <ng-container *polymorpheusOutlet="content as editContent">
                            {{ editContent }}
                        </ng-container>
                    } @else {
                        <button
                            appearance="flat"
                            size="s"
                            tuiButton
                            type="button"
                        >
                            Edit on {{ codeEditor!.name }}
                        </button>
                    }
                </tui-loader>
            }
            @if (fullscreenEnabled && example()) {
                <button
                    appearance="flat-grayscale"
                    size="xs"
                    tuiIconButton
                    type="button"
                    [iconStart]="fullscreen ? icons.shrink : icons.expand"
                    (click)="fullscreen = !fullscreen"
                >
                    Fullscreen
                </button>
            }
        </div>
        @for (tab of tabs; track tab) {
            <div class="t-content">
                @if (!$index && example()) {
                    <section
                        automation-id="tui-doc-example"
                        class="t-demo"
                        [style.display]="activeItemIndex === $index ? 'block' : 'none'"
                    >
                        <ng-content />
                        <ng-container *ngComponentOutlet="component() | async" />
                    </section>
                }
                @let code = processor()[tabs[$index] || 0] || '';
                <tui-doc-code
                    [code]="code"
                    [style.display]="activeItemIndex === $index && ($index || !example()) ? 'block' : 'none'"
                >
                    @for (action of codeActions; track action) {
                        <ng-container *polymorpheusOutlet="action as text; context: {$implicit: code}">
                            {{ text }}
                        </ng-container>
                    }
                </tui-doc-code>
            </div>
        }
    }
</div>
