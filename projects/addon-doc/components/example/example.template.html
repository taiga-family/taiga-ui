<div class="t-title-block">
    @if (heading()) {
        <h2 class="t-title">
            <span
                *polymorpheusOutlet="heading() as text"
                [textContent]="text"
            ></span>
        </h2>
    }

    @let fragmentId = id();

    @if (fragmentId) {
        <a
            routerLink="."
            routerLinkActive="t-link-active"
            tuiLink
            type="button"
            class="t-link"
            [attr.title]="copy()"
            [fragment]="fragmentId"
            [relativeTo]="route.firstChild ?? route"
            [routerLinkActiveOptions]="{matrixParams: 'exact', queryParams: 'exact', paths: 'exact', fragment: 'exact'}"
            (click)="copyExampleLink($event.currentTarget)"
        >
            #
        </a>
    }
</div>
@if (description()) {
    <h3 class="t-description">
        <ng-container *polymorpheusOutlet="description() as text">
            {{ text }}
        </ng-container>
    </h3>
}

<div
    class="t-example"
    [(tuiFullscreen)]="fullscreen"
>
    @if (processor() | tuiDocExampleGetTabs: defaultTab; as tabs) {
        @if (tabs.length > 1) {
            <div class="t-tabs-wrapper">
                <tui-tabs-with-more
                    class="t-tabs"
                    [(activeItemIndex)]="activeItemIndex"
                >
                    @for (tab of tabs; track tab) {
                        <button
                            *tuiItem
                            tuiTab
                            type="button"
                        >
                            <ng-container *polymorpheusOutlet="getTabTitle(tab) as text">
                                {{ text }}
                            </ng-container>
                        </button>
                    }
                </tui-tabs-with-more>
                @if (processor() | tuiMapper: visible) {
                    <tui-loader
                        size="xs"
                        class="t-code-editor"
                        [loading]="loading()"
                        [overlay]="true"
                        (click)="edit(processor())"
                    >
                        @if (codeEditor?.content; as content) {
                            <ng-container *polymorpheusOutlet="content as editContent">
                                {{ editContent }}
                            </ng-container>
                        } @else {
                            <button
                                appearance="flat"
                                size="s"
                                tuiButton
                                type="button"
                            >
                                Edit on {{ codeEditor!.name }}
                            </button>
                        }
                    </tui-loader>
                }
                @if (fullscreenEnabled) {
                    <button
                        appearance="flat"
                        size="xs"
                        tuiIconButton
                        type="button"
                        [iconStart]="fullscreen ? icons.shrink : icons.expand"
                        (click)="fullscreen = !fullscreen"
                    >
                        Fullscreen
                    </button>
                }
            </div>
        }
        @for (tab of tabs; track tab) {
            <div class="t-content">
                @if ($index === defaultTabIndex) {
                    <section
                        automation-id="tui-doc-example"
                        class="t-demo"
                        [style.display]="activeItemIndex === $index && $index === defaultTabIndex ? 'block' : 'none'"
                    >
                        <ng-content />
                        <ng-container *ngComponentOutlet="component() | async" />
                    </section>
                }
                @let code = processor()[tabs[$index] || 0] || '';
                <tui-doc-code
                    [code]="code"
                    [style.display]="activeItemIndex === $index && $index !== defaultTabIndex ? 'block' : 'none'"
                >
                    @for (action of codeActions; track action) {
                        <ng-container *polymorpheusOutlet="action as text; context: {$implicit: code}">
                            {{ text }}
                        </ng-container>
                    }
                </tui-doc-code>
            </div>
        }
    }
</div>
