@import '@taiga-ui/styles/utils';

@tick-thickness: 0.25rem;
@hitbox: 1rem;

:host {
    position: relative;
    display: block;
    block-size: @track-thickness;
    border-radius: var(--tui-radius-m);
    cursor: pointer;
    outline: none;
    margin: calc((@hitbox - @track-thickness) / 2) 0;
    touch-action: pan-x;
    color: var(--tui-background-accent-1);
    background: var(--tui-background-neutral-2);

    &:active {
        cursor: ew-resize;
    }

    &::after {
        content: '';
        position: absolute;
        inset: calc((@hitbox - @track-thickness) / -2) 0;
    }

    &._disabled {
        opacity: var(--tui-disabled-opacity);
        pointer-events: none;
    }
}

.t-track {
    :host & {
        position: relative;
        margin: 0 @thumb-diameter;
        block-size: 100%;

        /* Filled selected range */
        &::before {
            content: '';
            position: absolute;
            top: 0;
            inset-inline-start: calc(var(--t-start) - @thumb-diameter / 3);
            inset-inline-end: calc(var(--t-end) - @thumb-diameter / 3);
            block-size: 100%;
            background: currentColor;
        }

        /* Ticks */
        &::after {
            content: '';
            position: absolute;
            inset: 0;
            inset-inline-start: calc(-@tick-thickness / 2);
            inset-inline-end: calc(@tick-thickness / 2);
            background: repeating-linear-gradient(
                    to var(--tui-inline-end),
                    var(--tui-text-tertiary) 0 @tick-thickness,
                    transparent 0 calc(var(--t-segment-width) / var(--t-bg-size-ratio))
                )
                var(--tui-inline-end) 0 / calc(100% * var(--t-bg-size-ratio)) no-repeat;
        }
    }
}

.ignore-track-pointer-events() {
    pointer-events: none;

    &::-webkit-slider-thumb {
        pointer-events: auto;
    }

    &::-moz-range-thumb {
        pointer-events: auto;
    }

    :host._disabled & {
        &::-webkit-slider-thumb {
            pointer-events: none;
        }

        &::-moz-range-thumb {
            pointer-events: none;
        }
    }
}

:host .t-thumb {
    .ignore-track-pointer-events();

    position: absolute;
    z-index: 1;
    inset: 50% calc(-5 * @thumb-diameter / 12) auto;
    inline-size: auto;
    margin: 0;
    opacity: 1;
    transform: translateY(-50%);
    color: inherit;
    background: transparent;

    &:first-of-type {
        --tui-slider-thumb-transform: translateX(calc(var(--tui-inline) * -50%))
            translateX(calc(var(--tui-inline) * @thumb-diameter / -12));
    }

    &:last-of-type {
        --tui-slider-thumb-transform: translateX(calc(var(--tui-inline) * 50%))
            translateX(calc(var(--tui-inline) * @thumb-diameter / 12));
    }
}
