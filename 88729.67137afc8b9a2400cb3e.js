"use strict";(self.webpackChunk_taiga_ui_components=self.webpackChunk_taiga_ui_components||[]).push([[88729],{88729:(vt,le,T)=>{T.r(le),T.d(le,{Table:()=>Te,createTable:()=>Ne,default:()=>Te});var B=T(40256),C=T(62463),y=T(35917),He=T(13903),F=T(43594),ve=T(38480);let _,K;if("undefined"!=typeof WeakMap){let t=new WeakMap;_=e=>t.get(e),K=(e,n)=>(t.set(e,n),n)}else{let t=[],e=10,n=0;_=l=>{for(let o=0;o<t.length;o+=2)if(t[o]==l)return t[o+1]},K=(l,o)=>(n==e&&(n=0),t[n++]=l,t[n++]=o)}class k{constructor(e,n,l,o){this.left=e,this.top=n,this.right=l,this.bottom=o}}class b{constructor(e,n,l,o){this.width=e,this.height=n,this.map=l,this.problems=o}findCell(e){for(let n=0;n<this.map.length;n++){let l=this.map[n];if(l!=e)continue;let o=n%this.width,r=n/this.width|0,i=o+1,a=r+1;for(let s=1;i<this.width&&this.map[n+s]==l;s++)i++;for(let s=1;a<this.height&&this.map[n+this.width*s]==l;s++)a++;return new k(o,r,i,a)}throw new RangeError("No cell with offset "+e+" found")}colCount(e){for(let n=0;n<this.map.length;n++)if(this.map[n]==e)return n%this.width;throw new RangeError("No cell with offset "+e+" found")}nextCell(e,n,l){let{left:o,right:r,top:i,bottom:a}=this.findCell(e);return"horiz"==n?(l<0?0==o:r==this.width)?null:this.map[i*this.width+(l<0?o-1:r)]:(l<0?0==i:a==this.height)?null:this.map[o+this.width*(l<0?i-1:a)]}rectBetween(e,n){let{left:l,right:o,top:r,bottom:i}=this.findCell(e),{left:a,right:s,top:c,bottom:d}=this.findCell(n);return new k(Math.min(l,a),Math.min(r,c),Math.max(o,s),Math.max(i,d))}cellsInRect(e){let n=[],l={};for(let o=e.top;o<e.bottom;o++)for(let r=e.left;r<e.right;r++){let i=o*this.width+r,a=this.map[i];l[a]||(l[a]=!0,(r!=e.left||!r||this.map[i-1]!=a)&&(o!=e.top||!o||this.map[i-this.width]!=a)&&n.push(a))}return n}positionAt(e,n,l){for(let o=0,r=0;;o++){let i=r+l.child(o).nodeSize;if(o==e){let a=n+e*this.width,s=(e+1)*this.width;for(;a<s&&this.map[a]<r;)a++;return a==s?i-1:this.map[a]}r=i}}static get(e){return _(e)||K(e,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);let e=function(t){let e=-1,n=!1;for(let l=0;l<t.childCount;l++){let o=t.child(l),r=0;if(n)for(let i=0;i<l;i++){let a=t.child(i);for(let s=0;s<a.childCount;s++){let c=a.child(s);i+c.attrs.rowspan>l&&(r+=c.attrs.colspan)}}for(let i=0;i<o.childCount;i++){let a=o.child(i);r+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}-1==e?e=r:e!=r&&(e=Math.max(e,r))}return e}(t),n=t.childCount,l=[],o=0,r=null,i=[];for(let c=0,d=e*n;c<d;c++)l[c]=0;for(let c=0,d=0;c<n;c++){let f=t.child(c);d++;for(let h=0;;h++){for(;o<l.length&&0!=l[o];)o++;if(h==f.childCount)break;let g=f.child(h),{colspan:w,rowspan:R,colwidth:ze}=g.attrs;for(let L=0;L<R;L++){if(L+c>=n){(r||(r=[])).push({type:"overlong_rowspan",pos:d,n:R-L});break}let ee=o+L*e;for(let v=0;v<w;v++){0==l[ee+v]?l[ee+v]=d:(r||(r=[])).push({type:"collision",row:c,pos:d,n:w-v});let X=ze&&ze[v];if(X){let O=(ee+v)%e*2,te=i[O];null==te||te!=X&&1==i[O+1]?(i[O]=X,i[O+1]=1):te==X&&i[O+1]++}}}o+=w,d+=g.nodeSize}let u=(c+1)*e,p=0;for(;o<u;)0==l[o++]&&p++;p&&(r||(r=[])).push({type:"missing",row:c,n:p}),d++}let a=new b(e,n,l,r),s=!1;for(let c=0;!s&&c<i.length;c+=2)null!=i[c]&&i[c+1]<n&&(s=!0);return s&&function(t,e,n){t.problems||(t.problems=[]);for(let l=0,o={};l<t.map.length;l++){let r=t.map[l];if(o[r])continue;o[r]=!0;let i=n.nodeAt(r),a=null;for(let s=0;s<i.attrs.colspan;s++){let d=e[(l+s)%t.width*2];null!=d&&(!i.attrs.colwidth||i.attrs.colwidth[s]!=d)&&((a||(a=Ee(i.attrs)))[s]=d)}a&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}(a,i,t),a}(e))}}function Ee(t){if(t.colwidth)return t.colwidth.slice();let e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function S(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(let n in t.nodes){let l=t.nodes[n],o=l.spec.tableRole;o&&(e[o]=l)}}return e}const z=new C.H$("selectingCells");function D(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function x(t){let e=t.selection.$head;for(let n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function P(t){let e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&"cell"==e.node.type.spec.tableRole?e.$anchor:D(e.$head)||function(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){let l=e.type.spec.tableRole;if("cell"==l||"header_cell"==l)return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){let l=e.type.spec.tableRole;if("cell"==l||"header_cell"==l)return t.doc.resolve(n-e.nodeSize)}}(e.$head)}function U(t){return"row"==t.parent.type.spec.tableRole&&t.nodeAfter}function J(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function re(t,e,n){let l=t.start(-1),r=b.get(t.node(-1)).nextCell(t.pos-l,e,n);return null==r?null:t.node(0).resolve(l+r)}function A(t,e,n){let l={};for(let o in t)l[o]=t[o];return l[e]=n,l}function H(t,e,n=1){let l=A(t,"colspan",t.colspan-n);return l.colwidth&&(l.colwidth=l.colwidth.slice(),l.colwidth.splice(e,n),l.colwidth.some(o=>o>0)||(l.colwidth=null)),l}function ie(t,e,n=1){let l=A(t,"colspan",t.colspan+n);if(l.colwidth){l.colwidth=l.colwidth.slice();for(let o=0;o<n;o++)l.colwidth.splice(e,0,0)}return l}class m extends C.Y1{constructor(e,n=e){let l=e.node(-1),o=b.get(l),r=e.start(-1),i=o.rectBetween(e.pos-r,n.pos-r),a=e.node(0),s=o.cellsInRect(i).filter(d=>d!=n.pos-r);s.unshift(n.pos-r);let c=s.map(d=>{let f=l.nodeAt(d),u=d+r+1;return new C.xm(a.resolve(u),a.resolve(u+f.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){let l=e.resolve(n.map(this.$anchorCell.pos)),o=e.resolve(n.map(this.$headCell.pos));if(U(l)&&U(o)&&J(l,o)){let r=this.$anchorCell.node(-1)!=l.node(-1);return r&&this.isRowSelection()?m.rowSelection(l,o):r&&this.isColSelection()?m.colSelection(l,o):new m(l,o)}return C.Bs.between(l,o)}content(){let e=this.$anchorCell.node(-1),n=b.get(e),l=this.$anchorCell.start(-1),o=n.rectBetween(this.$anchorCell.pos-l,this.$headCell.pos-l),r={},i=[];for(let s=o.top;s<o.bottom;s++){let c=[];for(let d=s*n.width+o.left,f=o.left;f<o.right;f++,d++){let u=n.map[d];if(!r[u]){r[u]=!0;let p=n.findCell(u),h=e.nodeAt(u),g=o.left-p.left,w=p.right-o.right;if(g>0||w>0){let R=h.attrs;g>0&&(R=H(R,0,g)),w>0&&(R=H(R,R.colspan-w,w)),h=p.left<o.left?h.type.createAndFill(R):h.type.create(R,h.content)}if(p.top<o.top||p.bottom>o.bottom){let R=A(h.attrs,"rowspan",Math.min(p.bottom,o.bottom)-Math.max(p.top,o.top));h=p.top<o.top?h.type.createAndFill(R):h.type.create(R,h.content)}c.push(h)}}i.push(e.child(s).copy(y.HY.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:i;return new y.p2(y.HY.from(a),1,1)}replace(e,n=y.p2.empty){let l=e.steps.length,o=this.ranges;for(let i=0;i<o.length;i++){let{$from:a,$to:s}=o[i],c=e.mapping.slice(l);e.replace(c.map(a.pos),c.map(s.pos),i?y.p2.empty:n)}let r=C.Y1.findFrom(e.doc.resolve(e.mapping.slice(l).map(this.to)),-1);r&&e.setSelection(r)}replaceWith(e,n){this.replace(e,new y.p2(y.HY.from(n),0,0))}forEachCell(e){let n=this.$anchorCell.node(-1),l=b.get(n),o=this.$anchorCell.start(-1),r=l.cellsInRect(l.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let i=0;i<r.length;i++)e(n.nodeAt(r[i]),o+r[i])}isColSelection(){let e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);return!(Math.min(e,n)>0)&&Math.max(e+this.$anchorCell.nodeAfter.attrs.rowspan,n+this.$headCell.nodeAfter.attrs.rowspan)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){let l=b.get(e.node(-1)),o=e.start(-1),r=l.findCell(e.pos-o),i=l.findCell(n.pos-o),a=e.node(0);return r.top<=i.top?(r.top>0&&(e=a.resolve(o+l.map[r.left])),i.bottom<l.height&&(n=a.resolve(o+l.map[l.width*(l.height-1)+i.right-1]))):(i.top>0&&(n=a.resolve(o+l.map[i.left])),r.bottom<l.height&&(e=a.resolve(o+l.map[l.width*(l.height-1)+r.right-1]))),new m(e,n)}isRowSelection(){let e=b.get(this.$anchorCell.node(-1)),n=this.$anchorCell.start(-1),l=e.colCount(this.$anchorCell.pos-n),o=e.colCount(this.$headCell.pos-n);return!(Math.min(l,o)>0)&&Math.max(l+this.$anchorCell.nodeAfter.attrs.colspan,o+this.$headCell.nodeAfter.attrs.colspan)==e.width}eq(e){return e instanceof m&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){let l=b.get(e.node(-1)),o=e.start(-1),r=l.findCell(e.pos-o),i=l.findCell(n.pos-o),a=e.node(0);return r.left<=i.left?(r.left>0&&(e=a.resolve(o+l.map[r.top*l.width])),i.right<l.width&&(n=a.resolve(o+l.map[l.width*(i.top+1)-1]))):(i.left>0&&(n=a.resolve(o+l.map[i.top*l.width])),r.right<l.width&&(e=a.resolve(o+l.map[l.width*(r.top+1)-1]))),new m(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new m(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,l=n){return new m(e.resolve(n),e.resolve(l))}getBookmark(){return new G(this.$anchorCell.pos,this.$headCell.pos)}}m.prototype.visible=!1,C.Y1.jsonID("cell",m);class G{constructor(e,n){this.anchor=e,this.head=n}map(e){return new G(e.map(this.anchor),e.map(this.head))}resolve(e){let n=e.resolve(this.anchor),l=e.resolve(this.head);return"row"==n.parent.type.spec.tableRole&&"row"==l.parent.type.spec.tableRole&&n.index()<n.parent.childCount&&l.index()<l.parent.childCount&&J(n,l)?new m(n,l):C.Y1.near(l,1)}}function Pe(t){if(!(t.selection instanceof m))return null;let e=[];return t.selection.forEachCell((n,l)=>{e.push(F.p.node(l,l+n.nodeSize,{class:"selectedCell"}))}),F.EH.create(t.doc,e)}function Q(t,e){let n=t.createAndFill();return new ve.wx(n).replace(0,n.content.size,e).doc}function se(t,e,n,l,o,r,i,a){if(0==i||i==e.height)return!1;let s=!1;for(let c=o;c<r;c++){let d=i*e.width+c,f=e.map[d];if(e.map[d-e.width]==f){s=!0;let u=n.nodeAt(f),{top:p,left:h}=e.findCell(f);t.setNodeMarkup(t.mapping.slice(a).map(f+l),null,A(u.attrs,"rowspan",i-p)),t.insert(t.mapping.slice(a).map(e.positionAt(i,h,n)),u.type.createAndFill(A(u.attrs,"rowspan",p+u.attrs.rowspan-i))),c+=u.attrs.colspan-1}}return s}function ae(t,e,n,l,o,r,i,a){if(0==i||i==e.width)return!1;let s=!1;for(let c=o;c<r;c++){let d=c*e.width+i,f=e.map[d];if(e.map[d-1]==f){s=!0;let u=n.nodeAt(f),p=e.colCount(f),h=t.mapping.slice(a).map(f+l);t.setNodeMarkup(h,null,H(u.attrs,i-p,u.attrs.colspan-(i-p))),t.insert(h+u.nodeSize,u.type.createAndFill(H(u.attrs,0,i-p))),c+=u.attrs.rowspan-1}}return s}function ce(t,e,n,l,o){let r=n?t.doc.nodeAt(n-1):t.doc,i=b.get(r),{top:a,left:s}=l,c=s+o.width,d=a+o.height,f=t.tr,u=0;function p(){r=n?f.doc.nodeAt(n-1):f.doc,i=b.get(r),u=f.mapping.maps.length}(function(t,e,n,l,o,r,i){let c,d,s=S(t.doc.type.schema);if(o>e.width)for(let f=0,u=0;f<e.height;f++){let p=n.child(f);u+=p.nodeSize;let g,h=[];g=null==p.lastChild||p.lastChild.type==s.cell?c||(c=s.cell.createAndFill()):d||(d=s.header_cell.createAndFill());for(let w=e.width;w<o;w++)h.push(g);t.insert(t.mapping.slice(i).map(u-1+l),h)}if(r>e.height){let f=[];for(let h=0,g=(e.height-1)*e.width;h<Math.max(e.width,o);h++){let w=!(h>=e.width)&&n.nodeAt(e.map[g+h]).type==s.header_cell;f.push(w?d||(d=s.header_cell.createAndFill()):c||(c=s.cell.createAndFill()))}let u=s.row.create(null,y.HY.from(f)),p=[];for(let h=e.height;h<r;h++)p.push(u);t.insert(t.mapping.slice(i).map(l+n.nodeSize-2),p)}return!(!c&&!d)})(f,i,r,n,c,d,u)&&p(),se(f,i,r,n,s,c,a,u)&&p(),se(f,i,r,n,s,c,d,u)&&p(),ae(f,i,r,n,a,d,s,u)&&p(),ae(f,i,r,n,a,d,c,u)&&p();for(let h=a;h<d;h++){let g=i.positionAt(h,s,r),w=i.positionAt(h,c,r);f.replace(f.mapping.slice(u).map(g+n),f.mapping.slice(u).map(w+n),new y.p2(o.rows[h-a],0,0))}p(),f.setSelection(new m(f.doc.resolve(n+i.positionAt(a,s,r)),f.doc.resolve(n+i.positionAt(d-1,c-1,r)))),e(f)}const Ke=(0,He.$)({ArrowLeft:Y("horiz",-1),ArrowRight:Y("horiz",1),ArrowUp:Y("vert",-1),ArrowDown:Y("vert",1),"Shift-ArrowLeft":I("horiz",-1),"Shift-ArrowRight":I("horiz",1),"Shift-ArrowUp":I("vert",-1),"Shift-ArrowDown":I("vert",1),Backspace:j,"Mod-Backspace":j,Delete:j,"Mod-Delete":j});function $(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Y(t,e){return(n,l,o)=>{let r=n.selection;if(r instanceof m)return $(n,l,C.Y1.near(r.$headCell,e));if("horiz"!=t&&!r.empty)return!1;let i=de(o,t,e);if(null==i)return!1;if("horiz"==t)return $(n,l,C.Y1.near(n.doc.resolve(r.head+e),e));{let c,a=n.doc.resolve(i),s=re(a,t,e);return c=s?C.Y1.near(s,1):e<0?C.Y1.near(n.doc.resolve(a.before(-1)),-1):C.Y1.near(n.doc.resolve(a.after(-1)),1),$(n,l,c)}}}function I(t,e){return(n,l,o)=>{let r=n.selection;if(!(r instanceof m)){let a=de(o,t,e);if(null==a)return!1;r=new m(n.doc.resolve(a))}let i=re(r.$headCell,t,e);return!!i&&$(n,l,new m(r.$anchorCell,i))}}function j(t,e){let n=t.selection;if(!(n instanceof m))return!1;if(e){let l=t.tr,o=S(t.schema).cell.createAndFill().content;n.forEachCell((r,i)=>{r.content.eq(o)||l.replace(l.mapping.map(i+1),l.mapping.map(i+r.nodeSize-1),new y.p2(o,0,0))}),l.docChanged&&e(l)}return!0}function Ue(t,e){let l=D(t.state.doc.resolve(e));return!!l&&(t.dispatch(t.state.tr.setSelection(new m(l))),!0)}function Je(t,e,n){if(!x(t.state))return!1;let l=function(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:l}=t;for(;1==e.childCount&&(n>0&&l>0||"table"==e.firstChild.type.spec.tableRole);)n--,l--,e=e.firstChild.content;let o=e.firstChild,r=o.type.spec.tableRole,i=o.type.schema,a=[];if("row"==r)for(let s=0;s<e.childCount;s++){let c=e.child(s).content,d=s?0:Math.max(0,n-1),f=s<e.childCount-1?0:Math.max(0,l-1);(d||f)&&(c=Q(S(i).row,new y.p2(c,d,f)).content),a.push(c)}else{if("cell"!=r&&"header_cell"!=r)return null;a.push(n||l?Q(S(i).row,new y.p2(e,n,l)).content:e)}return function(t,e){let n=[];for(let o=0;o<e.length;o++){let r=e[o];for(let i=r.childCount-1;i>=0;i--){let{rowspan:a,colspan:s}=r.child(i).attrs;for(let c=o;c<o+a;c++)n[c]=(n[c]||0)+s}}let l=0;for(let o=0;o<n.length;o++)l=Math.max(l,n[o]);for(let o=0;o<n.length;o++)if(o>=e.length&&e.push(y.HY.empty),n[o]<l){let r=S(t).cell.createAndFill(),i=[];for(let a=n[o];a<l;a++)i.push(r);e[o]=e[o].append(y.HY.from(i))}return{height:e.length,width:l,rows:e}}(i,a)}(n),o=t.state.selection;if(o instanceof m){l||(l={width:1,height:1,rows:[y.HY.from(Q(S(t.state.schema).cell,n))]});let r=o.$anchorCell.node(-1),i=o.$anchorCell.start(-1),a=b.get(r).rectBetween(o.$anchorCell.pos-i,o.$headCell.pos-i);return l=function({width:t,height:e,rows:n},l,o){if(t!=l){let r=[],i=[];for(let a=0;a<n.length;a++){let s=n[a],c=[];for(let d=r[a]||0,f=0;d<l;f++){let u=s.child(f%s.childCount);d+u.attrs.colspan>l&&(u=u.type.create(H(u.attrs,u.attrs.colspan,d+u.attrs.colspan-l),u.content)),c.push(u),d+=u.attrs.colspan;for(let p=1;p<u.attrs.rowspan;p++)r[a+p]=(r[a+p]||0)+u.attrs.colspan}i.push(y.HY.from(c))}n=i,t=l}if(e!=o){let r=[];for(let i=0,a=0;i<o;i++,a++){let s=[],c=n[a%e];for(let d=0;d<c.childCount;d++){let f=c.child(d);i+f.attrs.rowspan>o&&(f=f.type.create(A(f.attrs,"rowspan",Math.max(1,o-f.attrs.rowspan)),f.content)),s.push(f)}r.push(y.HY.from(s))}n=r,e=o}return{width:t,height:e,rows:n}}(l,a.right-a.left,a.bottom-a.top),ce(t.state,t.dispatch,i,a,l),!0}if(l){let r=P(t.state),i=r.start(-1);return ce(t.state,t.dispatch,i,b.get(r.node(-1)).findCell(r.pos-i),l),!0}return!1}function Ge(t,e){if(e.ctrlKey||e.metaKey)return;let l,n=fe(t,e.target);if(e.shiftKey&&t.state.selection instanceof m)o(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&null!=(l=D(t.state.selection.$anchor))&&Z(t,e).pos!=l.pos)o(l,e),e.preventDefault();else if(!n)return;function o(a,s){let c=Z(t,s),d=null==z.getState(t.state);if(!c||!J(a,c)){if(!d)return;c=a}let f=new m(a,c);if(d||!t.state.selection.eq(f)){let u=t.state.tr.setSelection(f);d&&u.setMeta(z,a.pos),t.dispatch(u)}}function r(){t.root.removeEventListener("mouseup",r),t.root.removeEventListener("dragstart",r),t.root.removeEventListener("mousemove",i),null!=z.getState(t.state)&&t.dispatch(t.state.tr.setMeta(z,-1))}function i(a){let c,s=z.getState(t.state);if(null!=s)c=t.state.doc.resolve(s);else if(fe(t,a.target)!=n&&(c=Z(t,e),!c))return r();c&&o(c,a)}t.root.addEventListener("mouseup",r),t.root.addEventListener("dragstart",r),t.root.addEventListener("mousemove",i)}function de(t,e,n){if(!(t.state.selection instanceof C.Bs))return null;let{$head:l}=t.state.selection;for(let o=l.depth-1;o>=0;o--){let r=l.node(o);if((n<0?l.index(o):l.indexAfter(o))!=(n<0?0:r.childCount))return null;if("cell"==r.type.spec.tableRole||"header_cell"==r.type.spec.tableRole){let a=l.before(o);return t.endOfTextblock("vert"==e?n>0?"down":"up":n>0?"right":"left")?a:null}}return null}function fe(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e}function Z(t,e){let n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?D(t.state.doc.resolve(n.pos)):null}const Qe=new C.H$("fix-tables");function ue(t,e,n,l){let o=t.childCount,r=e.childCount;e:for(let i=0,a=0;i<r;i++){let s=e.child(i);for(let c=a,d=Math.min(o,i+3);c<d;c++)if(t.child(c)==s){a=c+1,n+=s.nodeSize;continue e}l(s,n),a<o&&t.child(a).sameMarkup(s)?ue(t.child(a),s,n+1,l):s.nodesBetween(0,s.content.size,l,n+1),n+=s.nodeSize}}function he(t,e){let n,l=(o,r)=>{"table"==o.type.spec.tableRole&&(n=function(t,e,n,l){let o=b.get(e);if(!o.problems)return l;l||(l=t.tr);let i,a,r=[];for(let s=0;s<o.height;s++)r.push(0);for(let s=0;s<o.problems.length;s++){let c=o.problems[s];if("collision"==c.type){let d=e.nodeAt(c.pos);for(let f=0;f<d.attrs.rowspan;f++)r[c.row+f]+=c.n;l.setNodeMarkup(l.mapping.map(n+1+c.pos),null,H(d.attrs,d.attrs.colspan-c.n,c.n))}else if("missing"==c.type)r[c.row]+=c.n;else if("overlong_rowspan"==c.type){let d=e.nodeAt(c.pos);l.setNodeMarkup(l.mapping.map(n+1+c.pos),null,A(d.attrs,"rowspan",d.attrs.rowspan-c.n))}else if("colwidth mismatch"==c.type){let d=e.nodeAt(c.pos);l.setNodeMarkup(l.mapping.map(n+1+c.pos),null,A(d.attrs,"colwidth",c.colwidth))}}for(let s=0;s<r.length;s++)r[s]&&(null==i&&(i=s),a=s);for(let s=0,c=n+1;s<o.height;s++){let d=e.child(s),f=c+d.nodeSize,u=r[s];if(u>0){let p="cell";d.firstChild&&(p=d.firstChild.type.spec.tableRole);let h=[];for(let w=0;w<u;w++)h.push(S(t.schema)[p].createAndFill());l.insert(l.mapping.map(0!=s&&i!=s-1||a!=s?f-1:c+1),h)}c=f}return l.setMeta(Qe,{fixTables:!0})}(t,o,r,n))};return e?e.doc!=t.doc&&ue(e.doc,t.doc,0,l):t.doc.descendants(l),n}function N(t){let i,e=t.selection,n=P(t),l=n.node(-1),o=n.start(-1),r=b.get(l);return i=e instanceof m?r.rectBetween(e.$anchorCell.pos-o,e.$headCell.pos-o):r.findCell(n.pos-o),i.tableStart=o,i.map=r,i.table=l,i}function pe(t,{map:e,tableStart:n,table:l},o){let r=o>0?-1:0;(function(t,e,n){let l=S(e.type.schema).header_cell;for(let o=0;o<t.height;o++)if(e.nodeAt(t.map[n+o*t.width]).type!=l)return!1;return!0})(e,l,o+r)&&(r=0==o||o==e.width?null:0);for(let i=0;i<e.height;i++){let a=i*e.width+o;if(o>0&&o<e.width&&e.map[a-1]==e.map[a]){let s=e.map[a],c=l.nodeAt(s);t.setNodeMarkup(t.mapping.map(n+s),null,ie(c.attrs,o-e.colCount(s))),i+=c.attrs.rowspan-1}else{let s=null==r?S(l.type.schema).cell:l.nodeAt(e.map[a+r]).type,c=e.positionAt(i,o,l);t.insert(t.mapping.map(n+c),s.createAndFill())}}return t}function tt(t,{map:e,table:n,tableStart:l},o){let r=t.mapping.maps.length;for(let i=0;i<e.height;){let a=i*e.width+o,s=e.map[a],c=n.nodeAt(s);if(o>0&&e.map[a-1]==s||o<e.width-1&&e.map[a+1]==s)t.setNodeMarkup(t.mapping.slice(r).map(l+s),null,H(c.attrs,o-e.colCount(s)));else{let d=t.mapping.slice(r).map(l+s);t.delete(d,d+c.nodeSize)}i+=c.attrs.rowspan}}function me(t,{map:e,tableStart:n,table:l},o){let r=n;for(let s=0;s<o;s++)r+=l.child(s).nodeSize;let i=[],a=o>0?-1:0;(function(t,e,n){let l=S(e.type.schema).header_cell;for(let o=0;o<t.width;o++)if(e.nodeAt(t.map[o+n*t.width]).type!=l)return!1;return!0})(e,l,o+a)&&(a=0==o||o==e.height?null:0);for(let s=0,c=e.width*o;s<e.width;s++,c++)if(o>0&&o<e.height&&e.map[c]==e.map[c-e.width]){let d=e.map[c],f=l.nodeAt(d).attrs;t.setNodeMarkup(n+d,null,A(f,"rowspan",f.rowspan+1)),s+=f.colspan-1}else{let d=null==a?S(l.type.schema).cell:l.nodeAt(e.map[c+a*e.width]).type;i.push(d.createAndFill())}return t.insert(r,S(l.type.schema).row.create(null,i)),t}function it(t,{map:e,table:n,tableStart:l},o){let r=0;for(let s=0;s<o;s++)r+=n.child(s).nodeSize;let i=r+n.child(o).nodeSize,a=t.mapping.maps.length;t.delete(r+l,i+l);for(let s=0,c=o*e.width;s<e.width;s++,c++){let d=e.map[c];if(o>0&&d==e.map[c-e.width]){let f=n.nodeAt(d).attrs;t.setNodeMarkup(t.mapping.slice(a).map(d+l),null,A(f,"rowspan",f.rowspan-1)),s+=f.colspan-1}else if(o<e.width&&d==e.map[c+e.width]){let f=n.nodeAt(d),u=f.type.create(A(f.attrs,"rowspan",f.attrs.rowspan-1),f.content),p=e.positionAt(o+1,s,n);t.insert(t.mapping.slice(a).map(l+p),u),s+=f.attrs.colspan-1}}}function ge(t){let e=t.content;return 1==e.childCount&&e.firstChild.isTextblock&&0==e.firstChild.childCount}function we(t,e){let n=t.selection;if(!(n instanceof m)||n.$anchorCell.pos==n.$headCell.pos)return!1;let l=N(t),{map:o}=l;if(function({width:t,height:e,map:n},l){let o=l.top*t+l.left,r=o,i=(l.bottom-1)*t+l.left,a=o+(l.right-l.left-1);for(let s=l.top;s<l.bottom;s++){if(l.left>0&&n[r]==n[r-1]||l.right<t&&n[a]==n[a+1])return!0;r+=t,a+=t}for(let s=l.left;s<l.right;s++){if(l.top>0&&n[o]==n[o-t]||l.bottom<e&&n[i]==n[i+t])return!0;o++,i++}return!1}(o,l))return!1;if(e){let s,c,r=t.tr,i={},a=y.HY.empty;for(let d=l.top;d<l.bottom;d++)for(let f=l.left;f<l.right;f++){let u=o.map[d*o.width+f],p=l.table.nodeAt(u);if(!i[u])if(i[u]=!0,null==s)s=u,c=p;else{ge(p)||(a=a.append(p.content));let h=r.mapping.map(u+l.tableStart);r.delete(h,h+p.nodeSize)}}if(r.setNodeMarkup(s+l.tableStart,null,A(ie(c.attrs,c.attrs.colspan,l.right-l.left-c.attrs.colspan),"rowspan",l.bottom-l.top)),a.size){let d=s+1+c.content.size,f=ge(c)?s+1:d;r.replaceWith(f+l.tableStart,d+l.tableStart,a)}r.setSelection(new m(r.doc.resolve(s+l.tableStart))),e(r)}return!0}function Ce(t,e){const n=S(t.schema);return function(t){return(e,n)=>{let o,r,l=e.selection;if(l instanceof m){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;o=l.$anchorCell.nodeAfter,r=l.$anchorCell.pos}else{if(o=function(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if("cell"===n||"header_cell"===n)return t.node(e)}return null}(l.$from),!o)return!1;r=D(l.$from).pos}if(1==o.attrs.colspan&&1==o.attrs.rowspan)return!1;if(n){let i=o.attrs,a=[],s=i.colwidth;i.rowspan>1&&(i=A(i,"rowspan",1)),i.colspan>1&&(i=A(i,"colspan",1));let f,c=N(e),d=e.tr;for(let u=0;u<c.right-c.left;u++)a.push(s?A(i,"colwidth",s&&s[u]?[s[u]]:null):i);for(let u=c.top;u<c.bottom;u++){let p=c.map.positionAt(u,c.left,c.table);u==c.top&&(p+=o.nodeSize);for(let h=c.left,g=0;h<c.right;h++,g++)h==c.left&&u==c.top||d.insert(f=d.mapping.map(p+c.tableStart,1),t({node:o,row:u,col:h}).createAndFill(a[g]))}d.setNodeMarkup(r,t({node:o,row:c.top,col:c.left}),a[0]),l instanceof m&&d.setSelection(new m(d.doc.resolve(l.$anchorCell.pos),f&&d.doc.resolve(f))),n(d)}return!0}}(({node:l})=>n[l.type.spec.tableRole])(t,e)}function be(t,e,n){const l=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let o=0;o<l.length;o++){const r=e.table.nodeAt(l[o]);if(r&&r.type!==n.header_cell)return!1}return!0}function E(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,n){if(!x(e))return!1;if(n){let l=S(e.schema),o=N(e),r=e.tr,i=o.map.cellsInRect("column"==t?new k(o.left,0,o.right,o.map.height):"row"==t?new k(0,o.top,o.map.width,o.bottom):o),a=i.map(s=>o.table.nodeAt(s));for(let s=0;s<i.length;s++)a[s].type==l.header_cell&&r.setNodeMarkup(o.tableStart+i[s],l.cell,a[s].attrs);if(0==r.steps.length)for(let s=0;s<i.length;s++)r.setNodeMarkup(o.tableStart+i[s],l.header_cell,a[s].attrs);n(r)}return!0}}(t):function(n,l){if(!x(n))return!1;if(l){let o=S(n.schema),r=N(n),i=n.tr,a=be("row",r,o),s=be("column",r,o),d=("column"===t?a:"row"===t&&s)?1:0,f="column"==t?new k(0,d,1,r.map.height):"row"==t?new k(d,0,r.map.width,1):r,u="column"==t?s?o.cell:o.header_cell:"row"==t?a?o.cell:o.header_cell:o.cell;r.map.cellsInRect(f).forEach(p=>{const h=p+r.tableStart,g=i.doc.nodeAt(h);g&&i.setNodeMarkup(h,u,g.attrs)}),l(i)}return!0}}E("row",{useDeprecatedLogic:!0}),E("column",{useDeprecatedLogic:!0});let ut=E("cell",{useDeprecatedLogic:!0});function ye(t){return function(e,n){if(!x(e))return!1;let l=function(t,e){if(e<0){let n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let l=t.index(-1)-1,o=t.before();l>=0;l--){let r=t.node(-1).child(l);if(r.childCount)return o-1-r.lastChild.nodeSize;o-=r.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;let n=t.node(-1);for(let l=t.indexAfter(-1),o=t.after();l<n.childCount;l++){let r=n.child(l);if(r.childCount)return o+1;o+=r.nodeSize}}}(P(e),t);if(null!=l){if(n){let o=e.doc.resolve(l);n(e.tr.setSelection(C.Bs.between(o,function(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}(o))).scrollIntoView())}return!0}}}class mt{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),q(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type==this.node.type&&(this.node=e,q(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return"attributes"==e.type&&(e.target==this.table||this.colgroup.contains(e.target))}}function q(t,e,n,l,o,r){let i=0,a=!0,s=e.firstChild,c=t.firstChild;for(let d=0,f=0;d<c.childCount;d++){let{colspan:u,colwidth:p}=c.child(d).attrs;for(let h=0;h<u;h++,f++){let g=o==f?r:p&&p[h],w=g?g+"px":"";i+=g||l,g||(a=!1),s?(s.style.width!=w&&(s.style.width=w),s=s.nextSibling):e.appendChild(document.createElement("col")).style.width=w}}for(;s;){let d=s.nextSibling;s.parentNode.removeChild(s),s=d}a?(n.style.width=i+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=i+"px")}const M=new C.H$("tableColumnResizing");function gt({handleWidth:t=5,cellMinWidth:e=25,View:n=mt,lastColumnResizable:l=!0}={}){return new C.Sy({key:M,state:{init(r,i){return this.spec.props.nodeViews[S(i.schema).table.name]=(a,s)=>new n(a,e,s),new W(-1,!1)},apply:(r,i)=>i.apply(r)},props:{attributes:r=>M.getState(r).activeHandle>-1?{class:"resize-cursor"}:null,handleDOMEvents:{mousemove(r,i){!function(t,e,n,l,o){let r=M.getState(t.state);if(!r.dragging){let i=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target),a=-1;if(i){let{left:s,right:c}=i.getBoundingClientRect();e.clientX-s<=n?a=Ae(t,e,"left"):c-e.clientX<=n&&(a=Ae(t,e,"right"))}if(a!=r.activeHandle){if(!o&&-1!==a){let s=t.state.doc.resolve(a),c=s.node(-1),d=b.get(c),f=s.start(-1);if(d.colCount(s.pos-f)+s.nodeAfter.attrs.colspan-1==d.width-1)return}Re(t,a)}}}(r,i,t,0,l)},mouseleave(r){!function(t){let e=M.getState(t.state);e.activeHandle>-1&&!e.dragging&&Re(t,-1)}(r)},mousedown(r,i){!function(t,e,n){let l=M.getState(t.state);if(-1==l.activeHandle||l.dragging)return!1;let o=t.state.doc.nodeAt(l.activeHandle),r=function(t,e,{colspan:n,colwidth:l}){let o=l&&l[l.length-1];if(o)return o;let r=t.domAtPos(e),a=r.node.childNodes[r.offset].offsetWidth,s=n;if(l)for(let c=0;c<n;c++)l[c]&&(a-=l[c],s--);return a/s}(t,l.activeHandle,o.attrs);function i(s){window.removeEventListener("mouseup",i),window.removeEventListener("mousemove",a);let c=M.getState(t.state);c.dragging&&(function(t,e,n){let l=t.state.doc.resolve(e),o=l.node(-1),r=b.get(o),i=l.start(-1),a=r.colCount(l.pos-i)+l.nodeAfter.attrs.colspan-1,s=t.state.tr;for(let c=0;c<r.height;c++){let d=c*r.width+a;if(c&&r.map[d]==r.map[d-r.width])continue;let f=r.map[d],{attrs:u}=o.nodeAt(f),p=1==u.colspan?0:a-r.colCount(f);if(u.colwidth&&u.colwidth[p]==n)continue;let h=u.colwidth?u.colwidth.slice():Mt(u.colspan);h[p]=n,s.setNodeMarkup(i+f,null,A(u,"colwidth",h))}s.docChanged&&t.dispatch(s)}(t,c.activeHandle,Se(c.dragging,s,n)),t.dispatch(t.state.tr.setMeta(M,{setDragging:null})))}function a(s){if(!s.which)return i(s);let c=M.getState(t.state),d=Se(c.dragging,s,n);!function(t,e,n,l){let o=t.state.doc.resolve(e),r=o.node(-1),i=o.start(-1),a=b.get(r).colCount(o.pos-i)+o.nodeAfter.attrs.colspan-1,s=t.domAtPos(o.start(-1)).node;for(;"TABLE"!=s.nodeName;)s=s.parentNode;q(r,s.firstChild,s,l,a,n)}(t,c.activeHandle,d,n)}t.dispatch(t.state.tr.setMeta(M,{setDragging:{startX:e.clientX,startWidth:r}})),window.addEventListener("mouseup",i),window.addEventListener("mousemove",a),e.preventDefault()}(r,i,e)}},decorations(r){let i=M.getState(r);if(i.activeHandle>-1)return function(t,e){let n=[],l=t.doc.resolve(e),o=l.node(-1),r=b.get(o),i=l.start(-1),a=r.colCount(l.pos-i)+l.nodeAfter.attrs.colspan;for(let s=0;s<r.height;s++){let c=a+s*r.width-1;if(!(a!=r.width&&r.map[c]==r.map[c+1]||0!=s&&r.map[c-1]==r.map[c-1-r.width])){let d=r.map[c],f=i+d+o.nodeAt(d).nodeSize-1,u=document.createElement("div");u.className="column-resize-handle",n.push(F.p.widget(f,u))}}return F.EH.create(t.doc,n)}(r,i.activeHandle)},nodeViews:{}}})}class W{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){let n=this,l=e.getMeta(M);if(l&&null!=l.setHandle)return new W(l.setHandle,null);if(l&&void 0!==l.setDragging)return new W(n.activeHandle,l.setDragging);if(n.activeHandle>-1&&e.docChanged){let o=e.mapping.map(n.activeHandle,-1);U(e.doc.resolve(o))||(o=null),n=new W(o,n.dragging)}return n}}function Ae(t,e,n){let l=t.posAtCoords({left:e.clientX,top:e.clientY});if(!l)return-1;let{pos:o}=l,r=D(t.state.doc.resolve(o));if(!r)return-1;if("right"==n)return r.pos;let i=b.get(r.node(-1)),a=r.start(-1),s=i.map.indexOf(r.pos-a);return s%i.width==0?-1:a+i.map[s-1]}function Se(t,e,n){return Math.max(n,t.startWidth+(e.clientX-t.startX))}function Re(t,e){t.dispatch(t.state.tr.setMeta(M,{setHandle:e}))}function Mt(t){let e=[];for(let n=0;n<t;n++)e.push(0);return e}function Nt({allowTableNodeSelection:t=!1}={}){return new C.Sy({key:z,state:{init:()=>null,apply(e,n){let l=e.getMeta(z);if(null!=l)return-1==l?null:l;if(null==n||!e.docChanged)return n;let{deleted:o,pos:r}=e.mapping.mapResult(n);return o?null:r}},props:{decorations:Pe,handleDOMEvents:{mousedown:Ge},createSelectionBetween(e){if(null!=z.getState(e.state))return e.state.selection},handleTripleClick:Ue,handleKeyDown:Ke,handlePaste:Je},appendTransaction:(e,n,l)=>function(t,e,n){let r,i,l=(e||t).selection,o=(e||t).doc;if(l instanceof C.qv&&(i=l.node.type.spec.tableRole)){if("cell"==i||"header_cell"==i)r=m.create(o,l.from);else if("row"==i){let a=o.resolve(l.from+1);r=m.rowSelection(a,a)}else if(!n){let a=b.get(l.node),s=l.from+1;r=m.create(o,s+1,s+a.map[a.width*a.height-1])}}else l instanceof C.Bs&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let n=t.pos,l=e.pos,o=t.depth;for(;o>=0&&!(t.after(o+1)<t.end(o));o--,n++);for(let r=e.depth;r>=0&&!(e.before(r+1)>e.start(r));r--,l--);return n==l&&/row|table/.test(t.node(o).type.spec.tableRole)}(l)?r=C.Bs.create(o,l.from):l instanceof C.Bs&&function({$from:t,$to:e}){let n,l;for(let o=t.depth;o>0;o--){let r=t.node(o);if("cell"===r.type.spec.tableRole||"header_cell"===r.type.spec.tableRole){n=r;break}}for(let o=e.depth;o>0;o--){let r=e.node(o);if("cell"===r.type.spec.tableRole||"header_cell"===r.type.spec.tableRole){l=r;break}}return n!==l&&0===e.parentOffset}(l)&&(r=C.Bs.create(o,l.$from.start(),l.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}(l,he(l,n),t)})}function Me(t,e,n,l,o,r){let i=0,a=!0,s=e.firstChild;const c=t.firstChild;for(let d=0,f=0;d<c.childCount;d+=1){const{colspan:u,colwidth:p}=c.child(d).attrs;for(let h=0;h<u;h+=1,f+=1){const g=o===f?r:p&&p[h],w=g?`${g}px`:"";i+=g||l,g||(a=!1),s?(s.style.width!==w&&(s.style.width=w),s=s.nextSibling):e.appendChild(document.createElement("col")).style.width=w}}for(;s;){const d=s.nextSibling;s.parentNode.removeChild(s),s=d}a?(n.style.width=`${i}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${i}px`)}class Tt{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Me(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type===this.node.type&&(this.node=e,Me(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return"attributes"===e.type&&(e.target===this.table||this.colgroup.contains(e.target))}}function xe(t,e){return e?t.createChecked(null,e):t.createAndFill()}function Ne(t,e,n,l,o){const r=function(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const l=t.nodes[n];l.spec.tableRole&&(e[l.spec.tableRole]=l)}),t.cached.tableNodeTypes=e,e}(t),i=[],a=[];for(let c=0;c<n;c+=1){const d=xe(r.cell,o);if(d&&a.push(d),l){const f=xe(r.header_cell,o);f&&i.push(f)}}const s=[];for(let c=0;c<e;c+=1)s.push(r.row.createChecked(null,l&&0===c?i:a));return r.table.createChecked(null,s)}const V=({editor:t})=>{const{selection:e}=t.state;if(!function(t){return t instanceof m}(e))return!1;let n=0;const l=(0,B.findParentNodeClosestToPos)(e.ranges[0].$from,r=>"table"===r.type.name);return null==l||l.node.descendants(r=>{if("table"===r.type.name)return!1;["tableCell","tableHeader"].includes(r.type.name)&&(n+=1)}),n===e.ranges.length&&(t.commands.deleteTable(),!0)},Te=B.Node.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:Tt,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({HTMLAttributes:t}){return["table",(0,B.mergeAttributes)(this.options.HTMLAttributes,t),["tbody",0]]},addCommands:()=>({insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:l,dispatch:o,editor:r})=>{const i=Ne(r.schema,t,e,n);if(o){const a=l.selection.anchor+1;l.replaceSelectionWith(i).scrollIntoView().setSelection(C.Bs.near(l.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>function(t,e){if(!x(t))return!1;if(e){let n=N(t);e(pe(t.tr,n,n.left))}return!0}(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>function(t,e){if(!x(t))return!1;if(e){let n=N(t);e(pe(t.tr,n,n.right))}return!0}(t,e),deleteColumn:()=>({state:t,dispatch:e})=>function(t,e){if(!x(t))return!1;if(e){let n=N(t),l=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(let o=n.right-1;tt(l,n,o),o!=n.left;o--)n.table=n.tableStart?l.doc.nodeAt(n.tableStart-1):l.doc,n.map=b.get(n.table);e(l)}return!0}(t,e),addRowBefore:()=>({state:t,dispatch:e})=>function(t,e){if(!x(t))return!1;if(e){let n=N(t);e(me(t.tr,n,n.top))}return!0}(t,e),addRowAfter:()=>({state:t,dispatch:e})=>function(t,e){if(!x(t))return!1;if(e){let n=N(t);e(me(t.tr,n,n.bottom))}return!0}(t,e),deleteRow:()=>({state:t,dispatch:e})=>function(t,e){if(!x(t))return!1;if(e){let n=N(t),l=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(let o=n.bottom-1;it(l,n,o),o!=n.top;o--)n.table=n.tableStart?l.doc.nodeAt(n.tableStart-1):l.doc,n.map=b.get(n.table);e(l)}return!0}(t,e),deleteTable:()=>({state:t,dispatch:e})=>function(t,e){let n=t.selection.$anchor;for(let l=n.depth;l>0;l--)if("table"==n.node(l).type.spec.tableRole)return e&&e(t.tr.delete(n.before(l),n.after(l)).scrollIntoView()),!0;return!1}(t,e),mergeCells:()=>({state:t,dispatch:e})=>we(t,e),splitCell:()=>({state:t,dispatch:e})=>Ce(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>E("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>E("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>ut(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>!!we(t,e)||Ce(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:l})=>function(t,e){return function(n,l){if(!x(n))return!1;let o=P(n);if(o.nodeAfter.attrs[t]===e)return!1;if(l){let r=n.tr;n.selection instanceof m?n.selection.forEachCell((i,a)=>{i.attrs[t]!==e&&r.setNodeMarkup(a,null,A(i.attrs,t,e))}):r.setNodeMarkup(o.pos,null,A(o.nodeAfter.attrs,t,e)),l(r)}return!0}}(t,e)(n,l),goToNextCell:()=>({state:t,dispatch:e})=>ye(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>ye(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&he(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const l=m.create(e.doc,t.anchorCell,t.headCell);e.setSelection(l)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:V,"Mod-Backspace":V,Delete:V,"Mod-Delete":V}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[gt({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Nt({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema:t=>({tableRole:(0,B.callOrReturn)((0,B.getExtensionField)(t,"tableRole",{name:t.name,options:t.options,storage:t.storage}))})})}}]);