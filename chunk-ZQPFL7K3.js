import{a as f}from"./chunk-SAZFJQSL.js";import{a as ue}from"./chunk-UGBLUDNX.js";import{a as ye}from"./chunk-TCUSBXMC.js";import{c as se,j as me,q as w}from"./chunk-5HZ452EF.js";import{b as pe}from"./chunk-QYE6BRLY.js";import{f as le}from"./chunk-WWLTLNBB.js";import{f as de}from"./chunk-PG52RPMH.js";import{b as ne}from"./chunk-OOOGG2EO.js";import{b as ie}from"./chunk-2NNJ62PY.js";import{b as ee,e as ae,g as oe}from"./chunk-G7V5KCZI.js";import{X as te}from"./chunk-643UB756.js";import{b as ce}from"./chunk-GSIOPKQB.js";import{Ta as re}from"./chunk-776UH3NW.js";import{C as Z,b as q,e as U,h as W,i as H,j as J,l as T,n as K,r as X,u as Y}from"./chunk-2ZAJENVJ.js";import{a as x,m as Q}from"./chunk-U7E5I6OK.js";import{q as j}from"./chunk-A5CZPNGX.js";import{Ac as P,Bc as k,Cb as r,Fc as $,Gc as z,Hc as A,La as g,Ma as v,Mc as c,Oc as E,Pc as L,Ta as V,Tb as N,Tc as R,Zb as h,cd as y,dd as _,fc as l,hc as F,j as M,ja as O,kc as m,mc as I,nc as D,oc as G,pc as n,qc as d,rc as u,vc as b,w as S,wb as B,za as C}from"./chunk-AXUCSVX7.js";var fe=["cardGroupedInput"];function Ce(o,e){if(o&1){let i=b();n(0,"div",4)(1,"div",10),P("click",function(){let a=g(i).$implicit,s=k();return v(s.payBySelectedCard(a))}),n(2,"div",11)(3,"div",12)(4,"div",13),c(5,"Card number"),d(),n(6,"div",14),u(7,"img",15),y(8,"tuiIcon"),n(9,"div",16),c(10),d()()()()()()}if(o&2){let i=e.$implicit;r(7),l("src",_(8,3,i.cardType==="MasterCard"?"@tui.maestro":i.cardType==="Visa"?"@tui.visa":"@tui.mir"),B),r(3),L(" ",i.firstSix,"****",i.lastFour," ")}}function ge(o,e){o&1&&u(0,"input",5)}function ve(o,e){o&1&&(n(0,"p"),c(1,"Please wait, we are loading fake cards..."),d())}function he(o,e){o&1&&(n(0,"div",4)(1,"label",17),u(2,"input",18),c(3," Remember card "),d()())}function be(o,e){if(o&1){let i=b();n(0,"div",8)(1,"button",19),P("click",function(){g(i);let a=k();return v(a.payByNewCard())}),c(2," New card "),d()()}}var p=class p{constructor(){this.payService=C(ue);this.destroyRef=C(V);this.form=new J({card:new T(null,[U.required,ye()]),saveCard:new T(!0)});this.iOS=C(Q);this.cards=[];this.paymentMode=f.ByNewCard;this.loading$=new M(!1);this.payProcessing$=new M(!1);this.paymentModeTypes=f;this.context=re();this.amount=this.context.data.amount}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(e){this.form.patchValue({card:{card:this.maskedNumber(e),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(w),this.paymentMode=f.BySavedCard,this.cardGroupedInput?.focusCVC()}payByNewCard(){this.form.patchValue({card:null}),this.form.controls.card.addValidators(w),this.paymentMode=f.ByNewCard,this.cardGroupedInput?.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe(x(this.destroyRef)).subscribe({next:()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()},error:()=>{this.payProcessing$.next(!1)}}))}cardValidator(e){return se(e)&&e.length===16}maskedNumber(e){return`${e.firstSix.slice(0,-2)}***${e.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe(O(e=>this.payService.getPrimaryCard().pipe(S(i=>[e,i]))),x(this.destroyRef)).subscribe({next:([,e])=>{this.cards=e.cards,e.primary?this.payBySelectedCard(e.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}};p.\u0275fac=function(i){return new(i||p)},p.\u0275cmp=N({type:p,selectors:[["pay-modal"]],viewQuery:function(i,t){if(i&1&&$(fe,5),i&2){let a;z(a=A())&&(t.cardGroupedInput=a.first)}},decls:20,vars:19,consts:[["cardGroupedInput",""],[1,"modal-container"],[1,"title"],[3,"formGroup"],[1,"form-block"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"loading","overlay"],["formControlName","card",3,"cardValidator","tuiTextfieldCleaner"],[1,"form-block","is--links"],["appearance","primary","size","l","tuiButton","","type","submit",3,"click","loading"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],["alt","card",1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],["iconStart","@tui.plus","tuiLink","","type","button",3,"click"]],template:function(i,t){if(i&1){let a=b();n(0,"div",1)(1,"h1",2),c(2,"Pay by card"),d(),n(3,"form",3),D(4,Ce,11,5,"div",4,I),n(6,"div",4),h(7,ge,1,0,"input",5),R(8),y(9,"async"),h(10,ve,2,0,"p"),n(11,"tui-loader",6),u(12,"tui-input-card-group",7,0),d()(),h(14,he,4,0,"div",4)(15,be,3,0,"div",8),d(),n(16,"button",9),y(17,"async"),P("click",function(){return g(a),v(t.pay())}),c(18),y(19,"tuiFormatNumber"),d()()}if(i&2){let a;r(3),l("formGroup",t.form),r(),G(t.cards),r(3),m(t.iOS?7:-1);let s=(a=_(9,13,t.loading$))!==null&&a!==void 0?a:!1;r(3),m(s?10:-1),r(),l("loading",s)("overlay",!0),r(),F("without-date",t.paymentMode===t.paymentModeTypes.BySavedCard),l("cardValidator",t.cardValidator)("tuiTextfieldCleaner",t.paymentMode===t.paymentModeTypes.ByNewCard),r(2),m(t.paymentMode===t.paymentModeTypes.ByNewCard?14:-1),r(),m(t.paymentMode===t.paymentModeTypes.BySavedCard?15:-1),r(),l("loading",!!_(17,15,t.payProcessing$)),r(2),E(" Pay ",_(19,17,t.amount)," \u20BD ")}},dependencies:[j,Z,K,q,W,H,X,Y,ce,te,pe,de,le,ee,me,ie,ne,oe,ae],styles:['[_nghost-%COMP%]     tui-input-card-group{inline-size:100%!important}[_nghost-%COMP%]     tui-input-card-group.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-group.without-date tui-icon[icon="@tui.x"]{display:none}[_nghost-%COMP%]     tui-input-card-group .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{inline-size:30rem}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{inline-size:100%}}.title[_ngcontent-%COMP%]{margin:0 0 1rem;font-weight:500;font-size:1.125rem;line-height:1.625rem;letter-spacing:.01125rem}.form-block[_ngcontent-%COMP%]{position:relative;margin-block-end:1rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{display:flex;block-size:3.5rem;background:#fafbfb;border-radius:1rem;border:2px solid #eaeaea;padding:0 1rem;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.015rem;font-size:.75rem;line-height:1.125rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{inline-size:2.25rem;block-size:1.375rem;background-position:center;background-repeat:no-repeat;margin-inline-end:.5rem}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:1.375rem;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:.875rem;line-height:1.25rem}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-inline-start:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;inline-size:100%;caret-color:transparent;cursor:none;color:transparent}'],changeDetection:0});var _e=p;export{_e as a};
